<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-2 Visa Complete Guide - Kang & Kriel Recruitment</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* ========================================
               NEW COLOR SYSTEM - Dual Color Design
               ======================================== */

            /* Primary - Minimalistic Blue */
            --primary-900: #1e293b;
            --primary-700: #334155;
            --primary-500: #64748b;
            --primary-300: #94a3b8;
            --primary-100: #f1f5f9;

            /* Secondary - Subtle Gray */
            --secondary-700: #475569;
            --secondary-500: #64748b;
            --secondary-300: #cbd5e1;
            --secondary-100: #f8fafc;

            /* Accent - Minimal & Functional */
            --accent-energy: #64748b;     /* Neutral gray instead of orange */
            --accent-success: #10b981;    /* Subtle green */
            --accent-warning: #f59e0b;    /* Keep warning visible */
            --accent-danger: #ef4444;     /* Keep danger visible */
            --accent-info: #64748b;       /* Neutral blue-gray */

            /* Neutral - Backgrounds & Text (WCAG AAA optimized) */
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-500: #57606a;  /* Darkened from #6b7280 for AAA contrast */
            --gray-700: #374151;
            --gray-900: #111827;

            /* Semantic Colors */
            --text-primary: var(--gray-900);     /* Contrast: 16.1:1 ✅ AAA */
            --text-secondary: var(--gray-700);   /* Contrast: 10.4:1 ✅ AAA */
            --text-tertiary: var(--gray-500);    /* Contrast: 7.1:1 ✅ AAA */
            --bg-primary: #ffffff;
            --bg-secondary: var(--gray-50);
            --border-color: var(--gray-200);

            /* Legacy compatibility (will be phased out) */
            --brand-primary: var(--primary-700);
            --brand-dark: var(--primary-900);
            --brand-light: var(--primary-500);
            --brand-bg: var(--secondary-100);

            /* ========================================
               TYPOGRAPHY SCALE - Major Second (1.25)
               ======================================== */

            /* Font Size Scale */
            --font-size-xs: 0.64rem;    /* 10.24px */
            --font-size-sm: 0.8rem;     /* 12.8px */
            --font-size-md: 1rem;       /* 16px - Base */
            --font-size-lg: 1.25rem;    /* 20px */
            --font-size-xl: 1.563rem;   /* 25px */
            --font-size-2xl: 1.953rem;  /* 31.25px */
            --font-size-3xl: 2.441rem;  /* 39px */
            --font-size-4xl: 3.052rem;  /* 48.8px */

            /* Semantic Font Sizes */
            --font-h1: var(--font-size-3xl);  /* 39px */
            --font-h2: var(--font-size-2xl);  /* 31.25px */
            --font-h3: var(--font-size-xl);   /* 25px */
            --font-h4: var(--font-size-lg);   /* 20px */
            --font-body: var(--font-size-md); /* 16px */
            --font-small: var(--font-size-sm);/* 12.8px */

            /* Font Weights - Simplified */
            --font-weight-regular: 400;
            --font-weight-medium: 600;
            --font-weight-bold: 700;

            /* Line Heights */
            --line-height-tight: 1.2;   /* For headings */
            --line-height-normal: 1.5;  /* For body text */
            --line-height-loose: 1.75;  /* For long text */

            /* ========================================
               SPACING SYSTEM - 8pt Grid
               ======================================== */
            --space-1: 0.5rem;   /* 8px */
            --space-2: 1rem;     /* 16px */
            --space-3: 1.5rem;   /* 24px */
            --space-4: 2rem;     /* 32px */
            --space-5: 2.5rem;   /* 40px */
            --space-6: 3rem;     /* 48px */
            --space-8: 4rem;     /* 64px */
            --space-10: 5rem;    /* 80px */
            --space-12: 6rem;    /* 96px */

            /* Semantic Spacing */
            --spacing-xs: var(--space-1);   /* 8px */
            --spacing-sm: var(--space-2);   /* 16px */
            --spacing-md: var(--space-3);   /* 24px */
            --spacing-lg: var(--space-4);   /* 32px */
            --spacing-xl: var(--space-5);   /* 40px */
            --spacing-2xl: var(--space-6);  /* 48px */

            /* ========================================
               ANIMATION & TRANSITION TIMING
               ======================================== */
            --duration-fast: 0.15s;    /* Quick interactions */
            --duration-normal: 0.3s;   /* Standard transitions */
            --duration-slow: 0.5s;     /* Smooth animations */
            --duration-slower: 0.8s;   /* Emphasis animations */

            --easing-standard: cubic-bezier(0.4, 0, 0.2, 1);
            --easing-smooth: ease-out;
            --easing-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* Respect user's motion preferences */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ========================================
           PHASE 3.1: DARK MODE
           ======================================== */
        @media (prefers-color-scheme: dark) {
            :root {
                /* Dark mode color overrides */
                --gray-50: #1f2937;
                --gray-100: #374151;
                --gray-200: #4b5563;
                --gray-300: #6b7280;
                --gray-500: #9ca3af;
                --gray-700: #d1d5db;
                --gray-900: #f9fafb;

                /* Semantic Colors - Dark Mode */
                --text-primary: #f9fafb;         /* Light text on dark bg */
                --text-secondary: #d1d5db;       /* Slightly muted */
                --text-tertiary: #9ca3af;        /* More muted */
                --bg-primary: #111827;           /* Dark background */
                --bg-secondary: #1f2937;         /* Slightly lighter dark */
                --border-color: #374151;         /* Dark borders */
            }

            body {
                background: var(--bg-primary);
            }

            .section, .progress-section, .nav-bar {
                background: var(--bg-secondary);
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            }

            .progress-bar-container {
                background: var(--gray-200);
            }

            .alert {
                background: var(--bg-secondary);
                border-left-width: 4px;
            }

            .checklist-item {
                background: var(--bg-primary);
            }

            .checklist-item:hover {
                background: var(--gray-100);
            }

            code {
                background: var(--gray-200);
                color: var(--text-primary);
            }

            pre {
                background: #0d1117;
                color: #f9fafb;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            font-size: var(--font-size-md);
            line-height: var(--line-height-normal);
            color: var(--text-primary);  /* WCAG AAA: 16.1:1 contrast */
            background: var(--bg-secondary);
        }

        .container {
            max-width: 1000px;  /* Optimized for better readability */
            margin: 0 auto;
            padding: 20px;  /* Increased from var(--spacing-md) for better spacing */
        }

        /* Header - Minimalistic */
        .header {
            background: linear-gradient(135deg, rgba(100, 116, 139, 0.03), rgba(100, 116, 139, 0.05));
            backdrop-filter: blur(10px);
            color: var(--gray-900);
            padding: var(--spacing-xl) var(--spacing-md);
            text-align: center;
            margin-bottom: var(--spacing-lg);
            border-bottom: 1px solid rgba(100, 116, 139, 0.1);
        }

        .header h1 {
            font-size: var(--font-h1);
            line-height: var(--line-height-tight);
            margin-bottom: var(--spacing-xs);
            font-weight: var(--font-weight-bold);
        }

        .header p {
            font-size: var(--font-size-lg);
            line-height: var(--line-height-normal);
            opacity: 0.95;
        }

        .brand-title {
            font-size: var(--font-h2);
            line-height: var(--line-height-tight);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-md);
            color: var(--gray-700);
        }

        /* Navigation - Minimalistic & Sticky */
        .nav-bar {
            position: sticky;
            top: 0;
            z-index: 999;  /* Above dashboard (998) but below back-to-top (998) */
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            border-radius: 0;  /* Remove border radius for sticky */
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-bottom: 2px solid rgba(100, 116, 139, 0.15);
        }

        .nav-buttons {
            display: flex;
            gap: var(--spacing-xs);
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: var(--spacing-xs) var(--spacing-md);
            border: none;
            border-radius: var(--spacing-xs);
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--gray-900);
            color: white;
        }

        .btn-primary:hover {
            background: var(--gray-700);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            color: var(--gray-700);
            border: 1px solid rgba(100, 116, 139, 0.2);
        }

        .btn-secondary:hover {
            background: white;
            border-color: var(--gray-300);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        /* Progress Bar - Minimalistic */
        .progress-section {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            padding: var(--spacing-md);
            border-radius: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid rgba(100, 116, 139, 0.1);
        }

        .progress-bar-container {
            width: 100%;
            height: var(--spacing-lg);
            background: #e5e7eb;
            border-radius: var(--spacing-sm);
            overflow: hidden;
            margin-top: var(--spacing-xs);
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gray-700), var(--gray-900));
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: var(--spacing-sm);
            color: white;
            font-weight: bold;
        }

        /* Alert Box */
        .alert {
            padding: 20px 24px;  /* Increased horizontal padding */
            border-radius: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
            border-left: 5px solid;
            position: relative;
            overflow: hidden;
        }

        /* ========================================
           PHASE 1.3: 시각적 계층 강화
           ======================================== */

        /* Critical Alert - 애니메이션 및 강조 */
        .alert-danger {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            border-left: 8px solid #64748b;
            color: #334155;
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.15);
            animation: pulseAlert 2s ease-in-out infinite;
        }

        @keyframes pulseAlert {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(100, 116, 139, 0.15);
            }
            50% {
                box-shadow: 0 4px 20px rgba(100, 116, 139, 0.25);
            }
        }

        /* Warning Alert - 강조 */
        .alert-warning {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-left: 6px solid #3b82f6;
            color: #1e40af;
            box-shadow: 0 2px 10px rgba(59, 130, 246, 0.1);
        }

        /* Info Alert */
        .alert-info {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-left: 5px solid var(--accent-info);
            color: #1e40af;
        }

        /* Success Alert */
        .alert-success {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-left: 5px solid var(--accent-success);
            color: #166534;
        }

        .alert h3 {
            font-size: var(--font-h3);
            line-height: var(--line-height-tight);
            margin-top: 0;  /* Remove top margin */
            margin-bottom: 12px;  /* Increased from 10px */
            font-weight: var(--font-weight-bold);
        }

        .alert h4 {
            font-size: var(--font-h4);
            line-height: var(--line-height-normal);
            margin-top: 0;  /* Remove top margin */
            margin-bottom: 10px;
            font-weight: var(--font-weight-medium);
        }

        .alert ul {
            margin-left: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .alert ol {
            margin-left: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .alert li {
            margin-bottom: 8px;
            line-height: var(--line-height-normal);
        }

        .alert p {
            margin-bottom: 10px;
        }

        .alert p:last-child {
            margin-bottom: 0;
        }

        /* Section */
        .section {
            background: white;
            border-radius: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: rgba(100, 116, 139, 0.08);
            backdrop-filter: blur(5px);
            color: var(--gray-900);
            padding: var(--spacing-md);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border: none;
            width: 100%;
            text-align: left;
            font-family: inherit;
            border-bottom: 1px solid rgba(100, 116, 139, 0.1);
        }

        .section-header:hover {
            background: rgba(100, 116, 139, 0.12);
        }

        .section-header h2 {
            font-size: var(--font-h2);
            line-height: var(--line-height-tight);
            font-weight: var(--font-weight-bold);
        }

        .section-header .toggle-icon {
            font-size: var(--font-h2);
            transition: transform 0.3s;
        }

        .section-header.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        .section-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.3s;
        }

        .section-content.expanded {
            padding: 24px;  /* Increased from var(--spacing-md) which is 16px */
            max-height: 10000px;
        }

        .section-content h3 {
            color: var(--gray-900);
            font-size: var(--font-h3);
            line-height: var(--line-height-tight);
            margin-top: var(--spacing-md);
            margin-bottom: 12px;  /* Increased from var(--spacing-xs) */
            font-weight: var(--font-weight-bold);
        }

        .section-content h3:first-child {
            margin-top: 0;  /* Remove top margin for first h3 */
        }

        .section-content h4 {
            color: var(--gray-700);
            font-size: var(--font-h4);
            line-height: var(--line-height-normal);
            margin-top: var(--spacing-sm);
            margin-bottom: 10px;  /* Increased from var(--spacing-xs) */
            font-weight: var(--font-weight-medium);
        }

        .section-content > h4:first-child {
            margin-top: 0;  /* Remove top margin for first h4 */
        }

        .section-content p {
            margin-bottom: 12px;
            line-height: var(--line-height-normal);
        }

        .section-content ul,
        .section-content ol {
            margin-left: 24px;
            margin-bottom: 16px;
        }

        .section-content li {
            margin-bottom: 8px;
            line-height: var(--line-height-normal);
        }

        /* Checklist */
        .checklist {
            list-style: none;
            margin: 15px 0;
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            padding: 10px;
            margin-bottom: 8px;
            background: #f9fafb;
            border-radius: 6px;
            transition: background 0.3s;
        }

        .checklist-item:hover {
            background: #f3f4f6;
        }

        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            margin-top: 3px;
            cursor: pointer;
            accent-color: var(--brand-primary);
        }

        .checklist-item label {
            flex: 1;
            cursor: pointer;
        }

        .checklist-item.completed label {
            text-decoration: line-through;
            color: #6b7280;
        }

        /* ========================================
           PHASE 1.1: ACCESSIBILITY ENHANCEMENTS
           ======================================== */

        /* Keyboard focus improvements - WCAG 2.1 Level AAA */
        button:focus-visible,
        input:focus-visible,
        a:focus-visible,
        .section-header:focus-visible {
            outline: 4px solid var(--primary-500);
            outline-offset: 3px;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }

        /* Touch target minimum size - WCAG 2.1 Level AAA (48x48px) */
        .section-header,
        input[type="checkbox"],
        button,
        .btn {
            min-height: 48px;
            min-width: 48px;
        }

        /* Checkbox size enhancement */
        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-top: 0;
            flex-shrink: 0; /* Prevent checkbox shrinking */
        }

        /* Skip to main content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary-700);
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            z-index: 10001;
        }

        .skip-link:focus {
            top: 0;
        }

        /* Ensure proper label clickability */
        .checklist-item label {
            cursor: pointer;
            -webkit-tap-highlight-color: rgba(59, 130, 246, 0.1);
        }

        /* ========================================
           PHASE 1.2: PROGRESS DASHBOARD
           ======================================== */

        .progress-dashboard {
            position: sticky;
            top: 0;
            z-index: 998;  /* Below nav-bar (999) */
            background: linear-gradient(135deg, rgba(100, 116, 139, 0.05), rgba(100, 116, 139, 0.1));
            backdrop-filter: blur(10px);
            color: var(--gray-900);
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.1);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 180px repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            align-items: center;
        }

        .dashboard-card {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(5px);
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 1px solid rgba(100, 116, 139, 0.1);
        }

        .dashboard-card:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .main-progress {
            grid-column: 1;
            justify-self: center;
        }

        .progress-circle {
            position: relative;
            width: 140px;
            height: 140px;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .percentage {
            display: block;
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
        }

        .percentage + .label {
            display: block;
            font-size: 0.875rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .urgent-card .stat-value {
            color: #fbbf24;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .mini-progress-bar {
            height: 4px;
            background: rgba(100, 116, 139, 0.15);
            border-radius: 2px;
            margin-top: 15px;
            overflow: hidden;
        }

        #mini-progress-fill {
            height: 100%;
            background: var(--gray-900);
            transition: width 0.5s ease;
        }

        /* Toast notification - Minimized */
        .toast {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            transition: bottom 0.3s ease;
            z-index: 10000;
            font-size: 0.875rem;
            max-width: 320px;
            max-height: 48px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .toast span:last-child {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .toast.show {
            bottom: 30px;
        }

        .toast.success {
            background: var(--accent-success);
        }

        .toast.error {
            background: var(--accent-danger);
        }

        .toast.info {
            background: var(--accent-info);
        }

        .undo-link {
            background: var(--primary-500);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .undo-link:hover {
            background: var(--primary-700);
        }

        /* ========================================
           PHASE 2: SEARCH & FILTER FUNCTIONALITY
           ======================================== */

        .search-container {
            position: sticky;
            top: 220px;
            z-index: 999;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .search-container input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            font-size: 16px;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            transition: all 0.3s ease;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%23666" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>');
            background-repeat: no-repeat;
            background-position: 15px center;
        }

        .search-container input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 20px;
            right: 20px;
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-top: 8px;
        }

        .search-results.show {
            display: block;
        }

        .search-result-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .search-result-item:hover {
            background: var(--gray-50);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .result-type {
            font-size: 0.75rem;
            color: var(--primary-500);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .result-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--gray-900);
        }

        .result-excerpt {
            font-size: 0.875rem;
            color: var(--gray-500);
            line-height: 1.4;
        }

        .search-result-item mark {
            background: #fef08a;
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: 600;
        }

        .search-no-results {
            padding: 20px;
            text-align: center;
            color: var(--gray-500);
        }

        /* Highlight animation for search results */
        @keyframes highlightFade {
            0% { background: #dbeafe; }
            100% { background: transparent; }
        }

        .search-highlight {
            animation: highlightFade 2s ease-out;
        }

        /* ========================================
           FEEDBACK CONTACT BANNER
           ======================================== */

        .feedback-banner {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 20px 30px;
            margin: 30px auto;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
            text-align: center;
            max-width: 900px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .feedback-banner h3 {
            margin: 0 0 10px 0;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .feedback-banner p {
            margin: 10px 0;
            font-size: 1rem;
            line-height: 1.6;
        }

        .feedback-banner a {
            color: white;
            font-weight: 700;
            text-decoration: underline;
            font-size: 1.1rem;
        }

        .feedback-banner a:hover {
            color: #fef3c7;
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .feedback-banner {
                padding: 15px 20px;
                margin: 20px 15px;
            }

            .feedback-banner h3 {
                font-size: 1.2rem;
            }

            .feedback-banner p {
                font-size: 0.9rem;
            }
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }

        th, td {
            padding: 14px 16px;  /* Increased padding for better spacing */
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: var(--brand-bg);
            color: var(--brand-dark);
            font-weight: 700;
        }

        tr:hover {
            background: #f9fafb;
        }

        /* Timeline */
        .timeline-item {
            position: relative;
            padding-left: 40px;
            margin-bottom: 30px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: -30px;
            width: 2px;
            background: var(--brand-light);
        }

        .timeline-item:last-child::before {
            display: none;
        }

        .timeline-dot {
            position: absolute;
            left: 0;
            top: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--brand-primary);
            border: 3px solid white;
            box-shadow: 0 0 0 2px var(--brand-primary);
        }

        .timeline-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--brand-primary);
        }

        .timeline-content h4 {
            color: var(--brand-dark);
            margin-bottom: 8px;
        }

        /* Card Grid */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: white;
            padding: 24px;  /* Increased from 20px */
            border-radius: 10px;
            border: 2px solid #e5e7eb;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: var(--brand-primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(174, 96, 49, 0.1);
        }

        .card h3 {
            color: var(--brand-dark);
            margin-bottom: 15px;  /* Increased from 10px */
            margin-top: 0;
        }

        .card h4 {
            color: var(--gray-700);
            margin-top: 0;  /* Remove top margin since card padding handles it */
            margin-bottom: 12px;
            font-weight: var(--font-weight-medium);
        }

        .card ul,
        .card ol {
            margin-left: 20px;
            margin-top: 10px;
        }

        .card li {
            margin-bottom: 8px;
            line-height: var(--line-height-normal);
        }

        .card-highlight {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-color: #3b82f6;
        }

        /* Code/Pre blocks */
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }

        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: var(--font-size-sm);
        }

        pre code {
            background: none;
            padding: 0;
        }

        /* Badge - 시각적 강화 */
        .badge {
            display: inline-block;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-bold);
            margin-right: 8px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .badge-urgent {
            background: linear-gradient(135deg, var(--accent-danger), #b91c1c);
            color: white;
            animation: badgePulse 2s ease-in-out infinite;
        }

        @keyframes badgePulse {
            0%, 100% {
                box-shadow: 0 2px 5px rgba(220, 38, 38, 0.3);
            }
            50% {
                box-shadow: 0 4px 10px rgba(220, 38, 38, 0.5);
            }
        }

        .badge-critical {
            background: linear-gradient(135deg, var(--accent-energy), #d97706);
            color: white;
        }

        .badge-info {
            background: linear-gradient(135deg, var(--accent-info), var(--primary-700));
            color: white;
        }

        .badge-success {
            background: linear-gradient(135deg, var(--accent-success), #16a34a);
            color: white;
        }

        /* Footer */
        .footer {
            background: #1f2937;
            color: white;
            text-align: center;
            padding: 40px 20px;
            margin-top: 40px;
        }

        .footer p {
            margin: 10px 0;
            opacity: 0.8;
        }

        /* ========================================
           PHASE 2.9: Enhanced Print Optimization
           ======================================== */

        @media print {
            /* Hide interactive elements */
            .nav-bar,
            .btn,
            .footer,
            .skip-to-content,
            .toast,
            .smart-guide-widget,
            .progress-insights,
            .quick-actions,
            .toggle-icon {
                display: none !important;
            }

            /* Page setup */
            @page {
                margin: 2cm 1.5cm;
                size: A4;
            }

            body {
                background: white;
                color: black;
                font-size: 11pt;
                line-height: 1.4;
            }

            /* Header styling for print */
            .header {
                background: white;
                color: black;
                border-bottom: 3px solid black;
                padding: 15px 0;
                margin-bottom: 20px;
            }

            .brand-title {
                color: black;
                font-size: var(--font-h3);
            }

            .header h1 {
                font-size: var(--font-h2);
                color: black;
            }

            /* Sections always expanded */
            .section {
                page-break-inside: avoid;
                margin-bottom: 15px;
            }

            .section-header {
                background: #f0f0f0 !important;
                color: black !important;
                padding: 10px !important;
                border: 2px solid #333;
                page-break-after: avoid;
            }

            .section-header h2 {
                font-size: var(--font-h3);
            }

            .section-content {
                max-height: none !important;
                padding: 20px !important;  /* Increased from 15px */
                opacity: 1 !important;
                display: block !important;
                border: 1px solid #ddd;
                border-top: none;
            }

            /* Progress section for print */
            .progress-section {
                background: white;
                border: 2px solid #333;
                padding: 10px;
                margin-bottom: 15px;
            }

            .progress-bar-container {
                border: 1px solid #333;
            }

            .progress-bar-fill {
                background: #333 !important;
            }

            /* Checklists */
            .checklist-item {
                page-break-inside: avoid;
                margin-bottom: 5px;
                background: white;
            }

            /* Checkboxes become check marks */
            .checklist-item input[type="checkbox"] {
                -webkit-appearance: none;
                appearance: none;
                width: 15px;
                height: 15px;
                border: 2px solid #333;
                position: relative;
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            .checklist-item input[type="checkbox"]:checked::after {
                content: "✓";
                position: absolute;
                top: -2px;
                left: 1px;
                font-size: 12pt;
                font-weight: bold;
                color: black;
            }

            /* Alerts */
            .alert {
                border: 2px solid black;
                background: white;
                page-break-inside: avoid;
                margin-bottom: 10px;
                padding: 12px 16px;  /* Better horizontal padding */
            }

            .alert-danger {
                border-left: 5px solid black;
                background: #f5f5f5;
            }

            .alert h3::before {
                content: "► ";
                font-weight: bold;
            }

            /* Tables */
            table {
                page-break-inside: avoid;
                border: 1px solid #333;
            }

            th {
                background: #e0e0e0 !important;
                color: black !important;
                border: 1px solid #333;
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            td {
                border: 1px solid #333;
            }

            /* Badges - convert to text */
            .badge {
                border: 1px solid black;
                padding: 2px 6px;
                background: white;
                color: black;
            }

            .badge-urgent::before {
                content: "[URGENT] ";
            }

            .badge-critical::before {
                content: "[CRITICAL] ";
            }

            /* Cards */
            .card {
                border: 1px solid #333;
                page-break-inside: avoid;
                background: white;
                box-shadow: none;
            }

            /* Links - show URLs */
            a[href^="http"]::after {
                content: " (" attr(href) ")";
                font-size: 9pt;
                color: #666;
                word-wrap: break-word;
            }

            /* Timeline */
            .timeline-item {
                page-break-inside: avoid;
                border-left: 3px solid #333;
                padding-left: 15px;
                margin-bottom: 10px;
            }

            .timeline-dot {
                background: black;
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }

            /* Footer for each page */
            @page {
                @bottom-right {
                    content: "Page " counter(page) " of " counter(pages);
                }
                @bottom-left {
                    content: "E-2 Visa Complete Guide";
                }
            }

            /* Add print timestamp */
            .progress-section::after {
                content: "Printed: " attr(data-print-date);
                display: block;
                margin-top: 10px;
                font-size: 9pt;
                color: #666;
            }

            /* Prevent widows and orphans */
            h1, h2, h3, h4, h5, h6 {
                page-break-after: avoid;
                page-break-inside: avoid;
            }

            p {
                orphans: 3;
                widows: 3;
            }

            /* Make sure colors print correctly */
            * {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 16px;  /* Slightly reduced for mobile but still comfortable */
            }

            .section-content.expanded {
                padding: 20px;  /* Consistent mobile padding */
            }

            .header h1 {
                font-size: var(--font-h2);
            }
            .nav-buttons {
                flex-direction: column;
            }
            .btn {
                width: 100%;
                min-height: 44px; /* iOS 권장 최소 터치 타겟 */
                padding: 12px 20px;
                font-size: var(--font-size-md); /* iOS 자동 줌 방지 */
            }
            .card-grid {
                grid-template-columns: 1fr;
                gap: 15px; /* 모바일에서 간격 조정 */
            }

            /* 체크박스 터치 타겟 확대 */
            .checklist-item input[type="checkbox"] {
                width: 28px;
                height: 28px;
                margin-right: 15px;
            }

            /* 섹션 헤더 터치 영역 확대 */
            .section-header {
                min-height: 60px;
                padding: 20px;
                cursor: pointer;
                -webkit-tap-highlight-color: rgba(174, 96, 49, 0.1);
            }

            /* 네비게이션 버튼 간격 */
            .nav-bar {
                padding: 12px;
            }

            .nav-buttons {
                gap: 8px;
            }

            /* 모바일에서 테이블 스크롤 */
            table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* 텍스트 가독성 향상 */
            body {
                font-size: var(--font-size-md);
                line-height: var(--line-height-normal);
            }

            /* Progress bar 터치 영역 */
            .progress-section {
                padding: 15px;
            }

            /* Alert 박스 여백 조정 */
            .alert {
                padding: 16px 20px;  /* Better horizontal padding */
                margin-bottom: 15px;
            }

            /* 카드 패딩 조정 */
            .card {
                padding: 20px;  /* Increased from 15px for better mobile spacing */
            }

            /* 타임라인 아이템 간격 */
            .timeline-item {
                padding-left: 30px;
                margin-bottom: 20px;
            }

            /* ========================================
               PHASE 1.2 & 1.4: DASHBOARD MOBILE OPTIMIZATION
               ======================================== */

            /* Dashboard mobile layout */
            .dashboard-grid {
                grid-template-columns: 1fr 1fr !important;
                gap: 12px;
            }

            .main-progress {
                grid-column: 1 / -1 !important;
                justify-self: center;
            }

            .progress-circle {
                width: 120px;
                height: 120px;
            }

            .percentage {
                font-size: 2rem;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .stat-label {
                font-size: 0.75rem;
            }

            .progress-dashboard {
                padding: 15px;
                margin-bottom: 20px;
            }

            /* Search container mobile */
            .search-container {
                padding: 10px 15px;
            }

            .search-container input {
                font-size: 16px; /* Prevent iOS zoom */
            }

            /* Badge adjustments */
            .badge {
                font-size: 0.7rem;
                padding: 3px 8px;
                margin: 2px;
            }

            /* Navigation stack */
            .nav-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .nav-buttons button,
            .nav-buttons .btn {
                width: 100%;
            }

            /* Smart guide mobile */
            .smart-guide-widget {
                margin-bottom: 20px;
            }

            /* Section spacing */
            .section {
                margin-bottom: 16px;
            }

            /* Alert mobile */
            .alert {
                padding: 12px;
                font-size: 0.9rem;
            }

            /* Text wrapping */
            h1, h2, h3, h4, h5, h6 {
                word-break: keep-all;
                overflow-wrap: break-word;
                hyphens: auto;
            }

            p, li, td {
                word-break: break-word;
            }
        }

        /* 작은 모바일 디바이스 (iPhone SE 등) */
        @media (max-width: 375px) {
            .header h1 {
                font-size: var(--font-h3);
            }

            .brand-title {
                font-size: var(--font-h4);
            }

            .btn {
                padding: 10px 15px;
                font-size: var(--font-size-sm);
            }

            .card {
                padding: 12px;
            }

            .alert {
                padding: 12px;
            }
        }

        /* 큰 모바일 디바이스 (태블릿) */
        @media (min-width: 768px) and (max-width: 1024px) {
            .card-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .nav-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .btn {
                width: auto;
                flex: 1;
                min-width: 140px;
            }
        }

        /* ========================================
           NAVIGATION ENHANCEMENTS
           ======================================== */

        /* Table of Contents */
        .toc {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            margin-bottom: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border: 1px solid rgba(100, 116, 139, 0.15);
        }

        .toc h2 {
            color: var(--gray-900);
            font-size: var(--font-h3);
            margin-bottom: 16px;
            font-weight: var(--font-weight-bold);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
        }

        .toc-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(100, 116, 139, 0.1);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: var(--gray-700);
            font-weight: 500;
        }

        .toc-item:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .toc-item.active {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-color: #3b82f6;
            color: var(--gray-900);
            font-weight: 600;
        }

        .toc-icon {
            font-size: 1.2rem;
            margin-right: 8px;
        }

        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: var(--gray-900);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 998;
            transition: all 0.3s;
        }

        .back-to-top:hover {
            background: var(--gray-700);
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
        }

        .back-to-top.show {
            display: flex;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Quick Jump Menu */
        .quick-jump {
            position: fixed;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 1px solid rgba(100, 116, 139, 0.15);
            z-index: 997;
            display: none;
        }

        .quick-jump.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .quick-jump-item {
            display: block;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.2rem;
            color: var(--gray-700);
            text-decoration: none;
            min-width: 40px;
        }

        .quick-jump-item:hover {
            background: var(--gray-100);
            transform: translateX(-3px);
        }

        .quick-jump-item.active {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            color: #3b82f6;
        }

        /* Link Styles */
        a {
            color: var(--primary-500); /* Blue - web standard */
            text-decoration: none;
            font-weight: 600;
        }

        a:hover {
            text-decoration: underline;
            color: var(--primary-700); /* Darker blue */
        }

        /* Strong emphasis */
        strong {
            color: var(--brand-dark);
            font-weight: 700;
        }

        /* Separator */
        hr {
            border: none;
            border-top: 2px solid #e5e7eb;
            margin: 30px 0;
        }

        /* ========================================
           PHASE 1.2: 인터랙션 피드백 애니메이션
           ======================================== */

        /* 체크박스 클릭 애니메이션 */
        .checkbox-animate {
            animation: checkPulse 0.3s ease-out;
        }

        @keyframes checkPulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
                background: linear-gradient(135deg, #eff6ff, #dbeafe);
            }
            100% {
                transform: scale(1);
            }
        }

        /* 체크박스 체크 시 애니메이션 */
        .checklist-item input[type="checkbox"]:checked {
            animation: checkSuccess 0.3s ease-out;
        }

        @keyframes checkSuccess {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        /* 진행률 바 부드러운 전환 */
        .progress-bar-fill {
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 섹션 확장 부드러운 애니메이션 */
        .section-content {
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                        padding 0.4s ease,
                        opacity 0.3s ease;
            opacity: 0;
        }

        .section-content.expanded {
            opacity: 1;
        }

        /* 토글 아이콘 회전 애니메이션 */
        .section-header .toggle-icon {
            transition: transform 0.3s ease;
        }

        .section-header.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        /* 버튼 호버 및 액티브 효과 강화 */
        .btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* 카드 호버 효과 강화 */
        .card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(174, 96, 49, 0.15);
        }

        /* Toast 알림 (성공 피드백용) */
        .toast {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease-out;
            max-width: 320px;
        }

        .toast.success {
            border-left: 4px solid #22c55e;
        }

        .toast.error {
            border-left: 4px solid #64748b;
        }

        .toast.info {
            border-left: 4px solid #3b82f6;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .toast.hiding {
            animation: slideOutRight 0.3s ease-out forwards;
        }

        /* 로딩 스피너 */
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid #f3f4f6;
            border-top-color: var(--brand-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 페이드 인 애니메이션 (새 콘텐츠용) */
        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Reduced Motion 지원 */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* 포커스 가시성 향상 */
        *:focus-visible {
            outline: 3px solid var(--brand-primary);
            outline-offset: 2px;
            border-radius: 4px;
        }

        /* 체크리스트 아이템 호버 효과 */
        .checklist-item {
            transition: all 0.2s ease;
        }

        .checklist-item:hover {
            background: #f3f4f6;
            transform: translateX(5px);
        }

        /* ========================================
           PHASE 1.4: 접근성 개선 (WCAG 2.1 AA)
           ======================================== */

        /* Skip to content 링크 */
        .skip-to-content {
            position: absolute;
            top: -100px;
            left: 0;
            background: var(--brand-primary);
            color: white;
            padding: 12px 20px;
            text-decoration: none;
            z-index: 1000;
            font-weight: 600;
            border-radius: 0 0 8px 0;
            transition: top 0.3s;
        }

        .skip-to-content:focus {
            top: 0;
            outline: 3px solid white;
            outline-offset: -3px;
        }

        /* 스크린 리더 전용 텍스트 */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* 키보드 포커스 강화 (모든 인터랙티브 요소) */
        button:focus-visible,
        input:focus-visible,
        a:focus-visible,
        [tabindex]:focus-visible {
            outline: 3px solid var(--brand-primary);
            outline-offset: 3px;
            border-radius: 4px;
        }

        /* 체크박스 포커스 특별 처리 */
        input[type="checkbox"]:focus-visible {
            outline: 3px solid var(--brand-primary);
            outline-offset: 3px;
            box-shadow: 0 0 0 6px rgba(174, 96, 49, 0.1);
        }

        /* 색맹 사용자를 위한 추가 표시 */
        .badge-urgent::before {
            content: "⚠️ ";
        }

        .badge-critical::before {
            content: "❗ ";
        }

        .badge-success::before {
            content: "✓ ";
        }

        /* 고대비 모드 지원 */
        @media (prefers-contrast: high) {
            .alert-danger {
                border-left-width: 10px;
                background: #fff;
                color: #000;
            }

            .alert-warning {
                border-left-width: 10px;
                background: #fff;
                color: #000;
            }

            .badge {
                border: 2px solid currentColor;
            }
        }

        /* 텍스트 크기 조정 시 레이아웃 유지 */
        @media (min-width: 1px) {
            html {
                font-size: 16px;
            }
        }

        /* 200% 확대 시 레이아웃 대응 */
        @media (max-width: 640px) {
            .nav-buttons {
                flex-direction: column;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 포커스 표시 영역 확대 */
        .section-header:focus-visible {
            outline: 4px solid var(--brand-primary);
            outline-offset: 2px;
            z-index: 10;
        }

        /* 링크 방문 상태 명확화 */
        a:visited {
            color: var(--brand-dark);
        }

        a:focus {
            background-color: rgba(174, 96, 49, 0.1);
            outline: 2px solid var(--brand-primary);
        }

        /* ========================================
           PHASE 2: Enhanced Features
           ======================================== */

        /* 2.4 Smart Next Step Widget */
        .smart-guide-widget {
            background: linear-gradient(135deg, #ffffff, #dbeafe);
            border: 3px solid var(--brand-primary);
            border-radius: 12px;
            padding: 0;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(174, 96, 49, 0.2);
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }

        .widget-header {
            background: linear-gradient(135deg, var(--brand-primary), var(--brand-dark));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .widget-header h3 {
            margin: 0;
            font-size: var(--font-h3);
            line-height: var(--line-height-tight);
            font-weight: var(--font-weight-bold);
        }

        .estimated-time {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        .widget-content {
            padding: 25px;
        }

        .current-step {
            margin-bottom: 20px;
        }

        .current-step h4 {
            color: var(--brand-dark);
            font-size: var(--font-h3);
            line-height: var(--line-height-tight);
            margin-bottom: 10px;
            font-weight: var(--font-weight-bold);
        }

        .current-step p {
            color: #6b7280;
            margin-bottom: 15px;
            font-size: var(--font-size-md);
            line-height: var(--line-height-normal);
        }

        .quick-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .quick-actions .btn {
            flex: 1;
            min-width: 150px;
        }

        .widget-footer {
            background: #dbeafe;
            padding: 15px 25px;
            border-top: 2px solid #fde68a;
        }

        .widget-footer p {
            margin: 0;
            color: #92400e;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-regular);
        }

        /* Progress Insights */
        .progress-insights {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .insight-icon {
            font-size: var(--font-h1);
        }

        .insight-text h3 {
            margin: 0 0 5px 0;
            color: var(--brand-dark);
            font-size: var(--font-h3);
            line-height: var(--line-height-tight);
        }

        .insight-text p {
            margin: 0;
            color: #6b7280;
            font-size: var(--font-size-sm);
            line-height: var(--line-height-normal);
        }

        .milestone-tracker {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .milestone {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #e5e7eb;
            transition: all 0.3s;
        }

        .milestone.completed {
            background: #f0fdf4;
            border-left-color: #22c55e;
        }

        .milestone.in-progress {
            background: #eff6ff;
            border-left-color: #f59e0b;
        }

        .milestone h4 {
            margin: 0 0 8px 0;
            font-size: var(--font-size-sm);
            line-height: var(--line-height-normal);
            color: #374151;
        }

        .milestone-status {
            font-size: var(--font-size-xs);
            color: #6b7280;
        }

        .milestone.completed .milestone-status {
            color: #22c55e;
            font-weight: var(--font-weight-medium);
        }

        .milestone.in-progress .milestone-status {
            color: #f59e0b;
            font-weight: var(--font-weight-medium);
        }

        /* Quick Tips Section */
        .quick-tips {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-left: 4px solid #3b82f6;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 15px 0;
        }

        .quick-tips h4 {
            color: #1e40af;
            margin: 0 0 10px 0;
            font-size: var(--font-h4);
            line-height: var(--line-height-normal);
        }

        .quick-tips ul {
            margin: 0;
            padding-left: 20px;
        }

        .quick-tips li {
            color: #1e40af;
            margin-bottom: 5px;
        }

        /* Mobile optimization for widgets */
        @media (max-width: 768px) {
            .quick-actions {
                flex-direction: column;
            }

            .quick-actions .btn {
                width: 100%;
                min-width: auto;
            }

            .widget-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .milestone-tracker {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to content 링크 (접근성) -->
    <a href="#main-content" class="skip-to-content">Skip to main content</a>
    <div class="header">
        <div class="brand-title">Kang & Kriel Recruitment</div>
        <h1>E-2 Visa Complete Guide</h1>
        <p>Comprehensive Guide: US → Korea E-2 Visa Process</p>
        <p style="font-size: var(--font-size-sm); margin-top: 10px;">Fast-Track 2-3 Week Document Preparation + Complete Process Guide</p>
    </div>

    <!-- Feedback Contact Banner -->
    <div class="feedback-banner">
        <h3>📧 Help Us Improve This Guide!</h3>
        <p>If you find anything incorrect or have suggestions for improvement,</p>
        <p>please let us know at <a href="mailto:jobs@esl365.com?subject=E-2 Visa Guide Feedback">jobs@esl365.com</a></p>
    </div>

    <div class="container" id="main-content" role="main">
        <!-- PHASE 1.2: Progress Dashboard -->
        <div id="progress-dashboard" class="progress-dashboard" role="region" aria-label="Progress overview">
            <div class="dashboard-grid">
                <!-- Main Progress Circle -->
                <div class="dashboard-card main-progress">
                    <div class="progress-circle" role="img" aria-label="Overall progress">
                        <svg viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(100, 116, 139, 0.15)" stroke-width="8"/>
                            <circle id="progress-ring" cx="50" cy="50" r="45" fill="none"
                                    stroke="var(--gray-900)" stroke-width="8"
                                    stroke-dasharray="283" stroke-dashoffset="283"
                                    transform="rotate(-90 50 50)"
                                    style="transition: stroke-dashoffset 0.5s ease;"/>
                        </svg>
                        <div class="progress-text">
                            <span id="overall-percentage" class="percentage">0%</span>
                            <span class="label">Complete</span>
                        </div>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="dashboard-card">
                    <div class="stat-value" id="tasks-completed">0/0</div>
                    <div class="stat-label">Tasks Done</div>
                </div>

                <div class="dashboard-card urgent-card">
                    <div class="stat-value urgent" id="urgent-count">0</div>
                    <div class="stat-label">🔥 Urgent Left</div>
                </div>

                <div class="dashboard-card">
                    <div class="stat-value" id="days-until">--</div>
                    <div class="stat-label">Days to Arrival</div>
                </div>

                <div class="dashboard-card">
                    <div class="stat-value" id="estimated-cost">$0-$0</div>
                    <div class="stat-label">💰 Remaining Cost</div>
                </div>
            </div>

            <!-- Mini Progress Bar -->
            <div class="mini-progress-bar">
                <div id="mini-progress-fill" style="width: 0%"></div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="nav-bar" role="navigation" aria-label="Main navigation">
            <div class="nav-buttons">
                <button class="btn btn-primary"
                        onclick="expandAll()"
                        aria-label="Expand all guide sections">
                    Expand All Sections
                </button>
                <button class="btn btn-primary"
                        onclick="collapseAll()"
                        aria-label="Collapse all guide sections">
                    Collapse All Sections
                </button>
                <button class="btn btn-secondary"
                        onclick="resetProgress()"
                        aria-label="Reset all progress tracking">
                    Reset Progress
                </button>
                <button class="btn btn-secondary"
                        onclick="exportProgress()"
                        aria-label="Export your progress data">
                    📥 Export Progress
                </button>
                <button class="btn btn-secondary"
                        onclick="document.getElementById('importFile').click()"
                        aria-label="Import previously saved progress">
                    📤 Import Progress
                </button>
                <button id="undoBtn" class="btn btn-secondary"
                        onclick="undoLastAction()"
                        disabled
                        aria-label="Undo last action">
                    ↩️ Undo
                </button>
                <button class="btn btn-secondary"
                        onclick="window.print()"
                        aria-label="Print this guide">
                    Print Guide
                </button>
            </div>
        </nav>

        <!-- Hidden file input for import -->
        <input type="file" id="importFile" accept="application/json" style="display:none"
               aria-label="Import saved progress file">

        <!-- Table of Contents -->
        <div class="toc" id="table-of-contents" role="navigation" aria-label="Table of contents">
            <h2>
                <span>📑</span>
                <span>Quick Navigation</span>
            </h2>
            <div class="toc-grid">
                <a href="#next-step" class="toc-item" onclick="smoothScroll(event, 'next-step')">
                    <span class="toc-icon">🎯</span>
                    <span>Your Next Step</span>
                </a>
                <a href="#timeline-header" class="toc-item" onclick="smoothScroll(event, 'timeline-header')">
                    <span class="toc-icon">📅</span>
                    <span>Interactive Timeline</span>
                </a>
                <a href="#smart-guide-header" class="toc-item" onclick="smoothScroll(event, 'smart-guide-header')">
                    <span class="toc-icon">🧭</span>
                    <span>Smart Guide</span>
                </a>
                <a href="#process-reality" class="toc-item" onclick="smoothScroll(event, 'process-reality')">
                    <span class="toc-icon">⏱️</span>
                    <span>Process Reality Check</span>
                </a>
                <a href="#pre-start-checklist" class="toc-item" onclick="smoothScroll(event, 'pre-start-checklist')">
                    <span class="toc-icon">✅</span>
                    <span>Pre-Start Checklist</span>
                </a>
                <a href="#master-checklist" class="toc-item" onclick="smoothScroll(event, 'master-checklist')">
                    <span class="toc-icon">📋</span>
                    <span>Master Checklist</span>
                </a>
                <a href="#faq" class="toc-item" onclick="smoothScroll(event, 'faq')">
                    <span class="toc-icon">❓</span>
                    <span>FAQs</span>
                </a>
                <a href="#cost-guide" class="toc-item" onclick="smoothScroll(event, 'cost-guide')">
                    <span class="toc-icon">💰</span>
                    <span>Cost Guide</span>
                </a>
            </div>
        </div>

        <!-- PHASE 2: Search Container -->
        <div class="search-container" role="search">
            <input type="search"
                   id="globalSearch"
                   placeholder="Search tasks, documents, or topics..."
                   aria-label="Search guide content">
            <div id="searchResults" class="search-results" role="listbox"></div>
        </div>

        <!-- Progress Tracker -->
        <section class="progress-section" aria-labelledby="progress-heading">
            <h3 id="progress-heading">Overall Progress</h3>
            <div class="progress-bar-container" role="progressbar"
                 aria-valuenow="0"
                 aria-valuemin="0"
                 aria-valuemax="100"
                 aria-label="Overall visa application progress">
                <div class="progress-bar-fill" id="progressBar" style="width: 0%;">
                    <span class="sr-only" id="progressSRText">0% complete</span>
                    0%
                </div>
            </div>
            <p style="margin-top: 10px; font-size: var(--font-size-sm); color: #6b7280;">
                <span id="progressText" aria-live="polite" aria-atomic="true">0 of 0 tasks completed</span>
            </p>
        </section>

        <!-- Smart Guide Widget (rendered dynamically) -->
        <div id="smart-guide-container"></div>

        <!-- Progress Insights (rendered dynamically) -->
        <div id="progress-insights-container"></div>

        <!-- Critical Warning -->
        <div class="alert alert-danger" style="animation: pulse 2s infinite;">
            <h3>🚨 CRITICAL WARNING - Read This First!</h3>
            <ul>
                <li><strong>FBI Check</strong> must get <strong>FEDERAL</strong> apostille from U.S. Department of State</li>
                <li><strong>Degree</strong> must get <strong>STATE</strong> apostille from Secretary of State (state where degree issued)</li>
                <li><strong>Names must match EXACTLY</strong> across all documents (passport, FBI, degree) including middle names</li>
                <li><strong>DIY FBI processing takes 14-16 weeks</strong>. Use a channeler (3-5 days) to avoid delays</li>
                <li><strong>Total Investment: $320-525</strong> for 2-3 week document preparation</li>
                <li><strong>Total Timeline: 5-7 weeks</strong> from start to visa in passport</li>
            </ul>
        </div>

        <!-- NEW: Critical Post-Arrival Actions -->
        <div class="alert alert-danger" style="border-left: 8px solid #dc2626;">
            <h3>🚨 CRITICAL: Immediate Action Required Upon Arrival in Korea</h3>

            <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 8px; margin: 15px 0;">
                <h4 style="color: #dc2626; margin-top: 0;">⚠️ Common Misconception vs. Reality</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
                    <div style="background: #e2e8f0; padding: 15px; border-radius: 6px;">
                        <strong style="color: #991b1b;">❌ What online guides say:</strong>
                        <p style="margin: 10px 0 0 0;">"You have 90 days to register for ARC"</p>
                    </div>
                    <div style="background: #dcfce7; padding: 15px; border-radius: 6px;">
                        <strong style="color: #166534;">✅ Your E-2 reality:</strong>
                        <p style="margin: 10px 0 0 0;">"You need to start teaching within days of arrival"</p>
                    </div>
                </div>
                <p style="margin-top: 15px; font-weight: bold; color: #991b1b;">
                    The Problem: Education offices require ARC (or application receipt) to register you as a teacher.
                    No registration = No teaching = No salary
                </p>
            </div>

            <h4 style="color: #dc2626;">📅 Your First Week Timeline:</h4>
            <div style="background: rgba(255,255,255,0.9); padding: 15px; border-radius: 8px; margin: 10px 0;">
                <div style="margin-bottom: 12px; padding: 12px; background: #f1f5f9; border-left: 4px solid #64748b; border-radius: 4px;">
                    <strong style="color: #991b1b;">Day 1-2: Health Check at MOJ Designated Hospital</strong>
                    <p style="margin: 5px 0 0 0;">Required for ARC application. Bring passport, ₩60,000-100,000, passport photo. Results same day or next day.</p>
                </div>
                <div style="margin-bottom: 12px; padding: 12px; background: #f1f5f9; border-left: 4px solid #64748b; border-radius: 4px;">
                    <strong style="color: #991b1b;">Day 3-5: Apply for ARC at Immigration Office</strong>
                    <p style="margin: 5px 0 0 0;">Bring health certificate, passport, housing contract, 2 photos, ₩30,000. Processing takes 1-2 weeks. <strong>Keep your receipt (접수증)!</strong></p>
                </div>
                <div style="margin-bottom: 12px; padding: 12px; background: #f1f5f9; border-left: 4px solid #3b82f6; border-radius: 4px;">
                    <strong style="color: #92400e;">Day 7-10: Education Office Teacher Registration</strong>
                    <p style="margin: 5px 0 0 0;"><strong>CRITICAL:</strong> Register with education office using ARC receipt. Required to legally teach and receive salary. Your school HR will assist.</p>
                </div>
            </div>

            <div style="background: #dbeafe; padding: 15px; border-radius: 8px; border: 2px solid #3b82f6; margin-top: 15px;">
                <strong style="color: #92400e;">💡 Key Insight:</strong>
                <p style="margin: 5px 0 0 0;">You don't need to wait for the physical ARC card! The application receipt (접수증) is accepted by banks, phone companies, and education offices. Start these processes immediately after applying for ARC.</p>
            </div>
        </div>

        <!-- Timeline Overview -->
        <div class="alert alert-info">
            <h3>📅 Complete Timeline: 5-7 Weeks</h3>
            <ul>
                <li><strong>Week 1-3:</strong> Document preparation (FBI + degree + apostilles) = 2-3 weeks</li>
                <li><strong>Week 4-5:</strong> Korea shipping + VIN processing = 2-3 weeks</li>
                <li><strong>Week 6-7:</strong> Consulate visa application = 3-5 days</li>
                <li><strong>After Arrival:</strong> Medical check + ARC within 90 days</li>
            </ul>
        </div>

        <div id="mainContent">
            <!-- Content sections will be dynamically managed here -->
        </div>

    </div>

    <div class="footer">
        <div class="brand-title">Kang & Kriel Recruitment</div>
        <p>⚠️ Disclaimer: Information current as of October 2025. Visa requirements may change.</p>
        <p>Always verify with Korea Immigration Service (immigration.go.kr) • Call 1345 (from Korea) or +82-2-1345 (international)</p>
        <p style="margin-top: 20px; font-size: var(--font-size-sm);">Document Version: Complete Guide v4.0</p>
        <p>© 2025 Kang & Kriel Recruitment. All rights reserved.</p>
    </div>

    <script>
        // Store all sections data
        const sectionsData = [
            {
                id: 'quick-start',
                title: '1. Quick Start Guide – Complete E-2 Visa Process',
                content: `
                    <h3>Total Timeline: 5-7 Weeks Start to Visa</h3>

                    <div class="alert alert-success">
                        <h4>Phase Breakdown:</h4>
                        <ol>
                            <li><strong>Week 1-3: Document preparation</strong> (FBI + degree + apostilles) = 2-3 weeks</li>
                            <li><strong>Week 4-5: Korea shipping + VIN processing</strong> = 2-3 weeks</li>
                            <li><strong>Week 6-7: Consulate visa application</strong> = 3-5 days</li>
                            <li><strong>Arrival: Medical check + ARC</strong> within 90 days</li>
                        </ol>
                    </div>

                    <h3>The Only Viable Process</h3>

                    <div class="card-grid">
                        <div class="card">
                            <h4>🔍 FBI Background Check:</h4>
                            <ul>
                                <li>FBI-approved channeler (Accurate Biometrics, Fieldprint): <strong>24-72 hours</strong></li>
                                <li>Monument Visa Federal apostille (rush): <strong>3-5 days</strong></li>
                                <li>✅ Total: <strong>1 week</strong></li>
                            </ul>
                        </div>

                        <div class="card">
                            <h4>🎓 Degree Authentication:</h4>
                            <ul>
                                <li>Local notary: <strong>Same day</strong> ($10-30)</li>
                                <li>Monument Visa State apostille (rush): <strong>3-5 days</strong></li>
                                <li>✅ Total: <strong>1 week</strong></li>
                            </ul>
                        </div>
                    </div>

                    <p><strong>All documents ready to ship: 2-3 weeks maximum</strong></p>

                    <h3>Two Must-Not-Fail Rules</h3>

                    <div class="alert alert-danger">
                        <h4>🔴 CRITICAL:</h4>
                        <ul>
                            <li><strong>FBI check ⇒ U.S. Department of State (Federal) apostille</strong></li>
                            <li><strong>Degree copy ⇒ Secretary of State of issuing state (State) apostille</strong></li>
                        </ul>
                        <p><strong>Mixing these up = automatic rejection.</strong> Monument Visa handles both correctly.</p>
                    </div>

                    <h3>Investment Required</h3>

                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Cost</th>
                                <th>Why Essential</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>FBI channeler</td>
                                <td>$40-100</td>
                                <td>24-72hr results vs. 14 weeks</td>
                            </tr>
                            <tr>
                                <td>Monument Visa FBI apostille</td>
                                <td>$55-75</td>
                                <td>Rush Federal apostille (10 days)</td>
                            </tr>
                            <tr>
                                <td>Monument Visa degree apostille</td>
                                <td>$100-125</td>
                                <td>Rush State apostille (2-3 days)</td>
                            </tr>
                            <tr>
                                <td>Notary (degree)</td>
                                <td>$10-30</td>
                                <td>Required before apostille</td>
                            </tr>
                            <tr>
                                <td>Photos, transcripts</td>
                                <td>$30-70</td>
                                <td>Standard requirements</td>
                            </tr>
                            <tr>
                                <td>Shipping to Korea</td>
                                <td>$40-80</td>
                                <td>Tracking essential</td>
                            </tr>
                            <tr>
                                <td>Consulate visa fee</td>
                                <td>~$45</td>
                                <td>Government fee</td>
                            </tr>
                            <tr style="background: #dbeafe; font-weight: bold;">
                                <td>TOTAL</td>
                                <td>$320-525</td>
                                <td>Protects $24K+ annual job</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="alert alert-warning">
                        <h4>Bottom Line</h4>
                        <p>Monument Visa + FBI channeler is not a "premium upgrade" or "optional fast-track."</p>
                        <p><strong>It's the only method that works for real-world hiring timelines.</strong></p>
                        <p>Budget for this from Day 1. Consider it mandatory job offer insurance.</p>
                    </div>
                `
            },
            {
                id: 'investment-breakdown',
                title: '2. Investment Breakdown – Budget Planning',
                content: `
                    <h3>Document Preparation Costs</h3>

                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Cost</th>
                                <th>Provider</th>
                                <th>Timeline</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>FBI channeler</td>
                                <td>$40-100</td>
                                <td>Accurate Biometrics, Fieldprint</td>
                                <td>24-72 hrs</td>
                            </tr>
                            <tr>
                                <td>Monument Visa - FBI apostille</td>
                                <td>$75</td>
                                <td>Monument Visa</td>
                                <td>10 business days</td>
                            </tr>
                            <tr>
                                <td>Degree notarization</td>
                                <td>$10-30</td>
                                <td>Local notary</td>
                                <td>Same day</td>
                            </tr>
                            <tr>
                                <td>Monument Visa - degree apostille</td>
                                <td>$125</td>
                                <td>Monument Visa</td>
                                <td>24-48 hours</td>
                            </tr>
                            <tr>
                                <td>Official transcripts (2 sets)</td>
                                <td>$20-50</td>
                                <td>University registrar</td>
                                <td>5-10 days</td>
                            </tr>
                            <tr>
                                <td>Passport photos (6-8)</td>
                                <td>$10-20</td>
                                <td>CVS, Walgreens, UPS</td>
                                <td>Same day</td>
                            </tr>
                            <tr>
                                <td><strong>Documents Subtotal</strong></td>
                                <td><strong>$260-395</strong></td>
                                <td></td>
                                <td><strong>2-3 weeks</strong></td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Shipping & Application</h3>

                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Cost</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>FedEx/DHL/UPS to Korea</td>
                                <td>$40-80</td>
                                <td>Must use tracked courier</td>
                            </tr>
                            <tr>
                                <td>Korean consulate visa fee</td>
                                <td>~$45</td>
                                <td>Varies slightly by consulate</td>
                            </tr>
                            <tr>
                                <td>Return postage (mail-in)</td>
                                <td>$20-50</td>
                                <td>USPS Priority Express</td>
                            </tr>
                            <tr>
                                <td><strong>Shipping Subtotal</strong></td>
                                <td><strong>$105-175</strong></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>After Arrival in Korea</h3>

                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Cost</th>
                                <th>Who Pays</th>
                                <th>When</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Health screening</td>
                                <td>$60-115</td>
                                <td>본인 부담 (체류 비용)</td>
                                <td>Week 1-2 in Korea</td>
                            </tr>
                            <tr>
                                <td>ARC application</td>
                                <td>~$30</td>
                                <td>본인 부담 (₩39,000: 발급 ₩35,000 + 우편 ₩4,000)</td>
                                <td>Within 90 days</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="alert alert-success">
                        <h3>💰 TOTAL INVESTMENT</h3>
                        <h4>Grand Total: $320-525</h4>
                        <p><strong>Timeline: 5-7 weeks start to visa in passport</strong></p>
                    </div>

                    <h3>ROI Analysis</h3>

                    <div class="card-grid">
                        <div class="card">
                            <h4>✅ What You Get for $320-525:</h4>
                            <ul>
                                <li>All documents in 2-3 weeks (vs. 16-20 weeks DIY)</li>
                                <li>Professional handling = zero errors</li>
                                <li>Make your start date</li>
                                <li>Keep your job offer</li>
                                <li>Peace of mind with tracking</li>
                                <li>Expert guidance through process</li>
                            </ul>
                        </div>
                        <div class="card">
                            <h4>❌ What Happens If You Try to Save $300:</h4>
                            <ul>
                                <li>Wait 16-20 weeks for documents</li>
                                <li>Miss start date by 8-12 weeks</li>
                                <li>Employer hires someone else</li>
                                <li>Lost job offer</li>
                                <li>Lost salary: $14,000-24,000 (6-12 months of work)</li>
                                <li>Wasted time: Entire job search process over</li>
                            </ul>
                        </div>
                    </div>

                    <div class="alert alert-warning">
                        <h3>📊 The Math:</h3>
                        <ul>
                            <li><strong>Invest:</strong> $320-525</li>
                            <li><strong>Protect:</strong> $24,000-36,000/year job</li>
                            <li><strong>ROI:</strong> 45-112 times your investment</li>
                        </ul>
                        <p><strong>This is not an expense. This is mandatory job offer insurance.</strong></p>
                    </div>

                    <h4>💳 Payment Tips</h4>
                    <ul>
                        <li>Monument Visa accepts credit cards</li>
                        <li>FBI channelers accept credit cards</li>
                        <li>Consider credit card rewards on $320-525 spend</li>
                        <li>Budget this into your Korea moving costs from Day 1</li>
                    </ul>
                `
            },
            {
                id: 'pre-start-checklist',
                title: '3. Pre-Start Checklist – Are You Ready?',
                content: `
                    <div class="alert alert-info">
                        <h3>✅ Before You Begin</h3>
                        <p>Review this checklist to ensure you're ready to start the E-2 visa process. Missing any of these can cause delays or rejection.</p>
                    </div>

                    <h3>Essential Requirements</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-1">
                            <label for="pre-1"><strong>Valid Passport:</strong> Must have 6+ months validity remaining</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-2">
                            <label for="pre-2"><strong>Bachelor's Degree Original:</strong> Physical diploma in your possession</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-3">
                            <label for="pre-3"><strong>Name Match Verified:</strong> Name on passport, degree, and all IDs match EXACTLY (including middle names)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-4">
                            <label for="pre-4"><strong>Budget Secured:</strong> $320-525 available for document costs</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-5">
                            <label for="pre-5"><strong>Job Offer Confirmed:</strong> School/employer ready to sponsor E-2 visa</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-6">
                            <label for="pre-6"><strong>Timeline Understood:</strong> You understand 5-7 week total timeline</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-7">
                            <label for="pre-7"><strong>Start Date Realistic:</strong> Your Korea start date is at least 7 weeks away</label>
                        </li>
                    </ul>

                    <h3>Document Verification</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-8">
                            <label for="pre-8"><strong>Degree is 4-year Bachelor's minimum</strong> (Associate's or 3-year degrees not accepted)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-9">
                            <label for="pre-9"><strong>Degree is from accredited university</strong> (not diploma mill)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-10">
                            <label for="pre-10"><strong>No criminal record issues</strong> (DUI, drug charges, violence may disqualify)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-11">
                            <label for="pre-11"><strong>Clean drug history for past 6+ months</strong> (marijuana, CBD will show on health screening)</label>
                        </li>
                    </ul>

                    <h3>Practical Readiness</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-12">
                            <label for="pre-12"><strong>Access to FBI channeler location</strong> (check accuratebiometrics.com for nearest location)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-13">
                            <label for="pre-13"><strong>Access to notary public</strong> (for degree certification)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-14">
                            <label for="pre-14"><strong>Reliable email access</strong> (for receiving documents and VIN)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-15">
                            <label for="pre-15"><strong>Can visit Korean consulate</strong> (or comfortable with mail-in process)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="pre-16">
                            <label for="pre-16"><strong>Employer's Korea address confirmed</strong> (for shipping documents)</label>
                        </li>
                    </ul>

                    <div class="alert alert-success">
                        <h3>✅ All Checked?</h3>
                        <p><strong>You're ready to start!</strong> Proceed to Section 4 (Master Checklist) to begin the process.</p>
                    </div>

                    <div class="alert alert-warning">
                        <h3>⚠️ Missing Items?</h3>
                        <p>Resolve any missing items before starting. Common issues:</p>
                        <ul>
                            <li><strong>Passport expiring soon:</strong> Renew now (takes 4-6 weeks)</li>
                            <li><strong>Can't find degree:</strong> Request duplicate from university ($20-50, 2-4 weeks)</li>
                            <li><strong>Name mismatch:</strong> Legally change name on documents (varies by state, 2-8 weeks)</li>
                            <li><strong>Criminal record:</strong> Consult with Kang & Kriel before proceeding</li>
                        </ul>
                    </div>
                `
            },
            {
                id: 'master-checklist',
                title: '4. Master Checklist – Required Documents',
                content: `
                    <h3>Documents You'll Ship to Korea (for CCVI)</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="doc-fbi" onchange="toggleCheckbox('doc-fbi')">
                            <label for="doc-fbi"><strong>FBI Identity History Summary</strong> (issued ≤ 6 months; Federal apostille attached)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="doc-degree" onchange="toggleCheckbox('doc-degree')">
                            <label for="doc-degree"><strong>Bachelor's degree copy</strong> (notarized true copy) with State apostille attached</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="doc-certificate-app" onchange="toggleCheckbox('doc-certificate-app')">
                            <label for="doc-certificate-app">
                                <strong>APPLICATION FOR CERTIFICATE OF VISA ELIGIBILITY</strong> (Items 1-7 completed by you; employer will complete the rest)
                                <br>
                                <a href="https://github.com/esl365/e2-visa-forms/raw/refs/heads/main/APPLICATION%20FOR%20CERTIFICATE%20OF%20VISA%20ELIGIBILITY.pdf" target="_blank" rel="noopener noreferrer" style="color: var(--primary-500); text-decoration: underline; font-size: 0.9rem;">
                                    📥 Download Form (PDF)
                                </a>
                            </label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="doc-health" onchange="toggleCheckbox('doc-health')">
                            <label for="doc-health">
                                <strong>Self-Health Statement</strong> (E-2 health questionnaire; signed)
                                <br>
                                <a href="https://github.com/esl365/e2-visa-forms/raw/refs/heads/main/E2_Applicants_Health_Statement.pdf" target="_blank" rel="noopener noreferrer" style="color: var(--primary-500); text-decoration: underline; font-size: 0.9rem;">
                                    📥 Download Form (PDF)
                                </a>
                            </label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="doc-passport-copy" onchange="toggleCheckbox('doc-passport-copy')">
                            <label for="doc-passport-copy"><strong>Passport bio page copy</strong> (color, high-res)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="doc-contract" onchange="toggleCheckbox('doc-contract')">
                            <label for="doc-contract"><strong>Signed employment contract</strong> (original, fully executed)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="doc-resume" onchange="toggleCheckbox('doc-resume')">
                            <label for="doc-resume"><strong>Resume/CV</strong> (signed and dated)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="doc-photos" onchange="toggleCheckbox('doc-photos')">
                            <label for="doc-photos"><strong>Passport photos</strong> (2-4 spares, 3.5×4.5cm)</label>
                        </li>
                    </ul>

                    <h3>Documents for Consulate (after receiving VIN)</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="consul-vin" onchange="toggleCheckbox('consul-vin')">
                            <label for="consul-vin"><strong>VIN</strong> (Visa Issuance Number) from employer</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="consul-app" onchange="toggleCheckbox('consul-app')">
                            <label for="consul-app"><strong>Visa Application Form</strong> (complete, signed)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="consul-photo" onchange="toggleCheckbox('consul-photo')">
                            <label for="consul-photo"><strong>1 passport photo</strong> (attached to application)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="consul-passport" onchange="toggleCheckbox('consul-passport')">
                            <label for="consul-passport"><strong>Original passport</strong> (≥ 6 months validity, 1+ blank page)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="consul-fee" onchange="toggleCheckbox('consul-fee')">
                            <label for="consul-fee"><strong>Visa fee</strong> (~$45 cash/money order)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="consul-dl" onchange="toggleCheckbox('consul-dl')">
                            <label for="consul-dl"><strong>Driver's license</strong> (proof of residency)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="consul-envelope" onchange="toggleCheckbox('consul-envelope')">
                            <label for="consul-envelope"><strong>Prepaid return envelope</strong> (if mailing)</label>
                        </li>
                    </ul>

                    <h3>After Arrival in Korea</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="arrival-health" onchange="toggleCheckbox('arrival-health')">
                            <label for="arrival-health"><strong>Health screening</strong> at designated hospital (within 2 weeks recommended)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="arrival-address" onchange="toggleCheckbox('arrival-address')">
                            <label for="arrival-address"><strong>Address registration</strong> (within 14 days, mandatory)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="arrival-arc" onchange="toggleCheckbox('arrival-arc')">
                            <label for="arrival-arc"><strong>ARC application</strong> (within 90 days of entry)</label>
                        </li>
                    </ul>
                `
            },
            {
                id: 'document-prep',
                title: '5. Document Preparation – Step-by-Step Guide',
                content: `
                    <h3>2.1 FBI Identity History Summary – Channeler Method ONLY</h3>

                    <div class="alert alert-danger">
                        <h4>⏰ TIME-CRITICAL: Start this on Day 1 of your visa process</h4>
                    </div>

                    <p><strong>Goal:</strong> FBI background check in 24-72 hours</p>

                    <h4>The Only Viable Method: FBI-Approved Channeler</h4>

                    <p>FBI-approved channelers provide digital fingerprinting (Live Scan) and submit electronically to FBI. Results delivered in 24-72 hours.</p>

                    <div class="card-grid">
                        <div class="card card-highlight">
                            <h4>Accurate Biometrics (MOST RECOMMENDED)</h4>
                            <ul>
                                <li>825+ locations nationwide (often inside/near UPS stores)</li>
                                <li>Website: <a href="https://accuratebiometrics.com" target="_blank">accuratebiometrics.com</a></li>
                                <li>Online appointment booking</li>
                                <li>Cost: $40-100 (includes FBI $18 fee)</li>
                                <li>PDF results emailed in 24-72 hours</li>
                                <li>Monument Visa accepts their PDFs</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h4>Fieldprint</h4>
                            <ul>
                                <li>National coverage</li>
                                <li>Website: <a href="https://fieldprintusa.com" target="_blank">fieldprintusa.com</a></li>
                                <li>Similar pricing and timeline</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h4>Idemia</h4>
                            <ul>
                                <li>Many locations</li>
                                <li>Website: <a href="https://idemia.com" target="_blank">idemia.com</a></li>
                            </ul>
                        </div>
                    </div>

                    <h4>Process:</h4>
                    <ol>
                        <li>Visit channeler website and find nearest location</li>
                        <li>Book appointment online</li>
                        <li>Arrive with photo ID (driver's license or passport)</li>
                        <li>Get fingerprints taken (Live Scan, 5 minutes)</li>
                        <li>Pay $40-100</li>
                        <li>Tell them: "For international employment in Korea, E-2 visa"</li>
                        <li>Receive PDF by email in 24-72 hours</li>
                    </ol>

                    <div class="alert alert-danger">
                        <h4>❌ NEVER:</h4>
                        <ul>
                            <li>DO NOT apply directly to FBI (14-16 weeks, impractical)</li>
                            <li>DO NOT use state/local police checks (not accepted for E-2)</li>
                            <li>DO NOT try to rush FBI direct process (impossible)</li>
                        </ul>
                    </div>

                    <h3>2.2 Bachelor's Degree – Notarization for State Apostille</h3>

                    <div class="alert alert-warning">
                        <p><strong>✅ MUST DO:</strong> Name on degree must match passport exactly (including middle names)</p>
                    </div>

                    <h4>Process:</h4>

                    <p><strong>Step 1: Prepare Your Degree</strong></p>
                    <ul>
                        <li>Locate your Bachelor's degree diploma (4-year degree required)</li>
                        <li>Make a high-quality photocopy</li>
                        <li>If degree is in Latin: Get English version from university first</li>
                    </ul>

                    <p><strong>Step 2: Get Notarized</strong></p>
                    <ul>
                        <li>Find a notary public:
                            <ul>
                                <li>Your bank (often free for customers)</li>
                                <li>UPS Store</li>
                                <li>Shipping stores (FedEx Office, etc.)</li>
                                <li>Mobile notaries (search "notary near me")</li>
                            </ul>
                        </li>
                        <li>Bring: Original diploma + photocopy + photo ID</li>
                        <li>Request: "Notarized true copy" certification</li>
                        <li>Cost: $10-30</li>
                        <li>Time: 10 minutes</li>
                    </ul>

                    <div class="alert alert-danger">
                        <h4>Common Issues to Avoid:</h4>
                        <ul>
                            <li>❌ Middle name missing from degree but on passport → Contact university for corrected diploma</li>
                            <li>❌ Name changed after marriage → Use maiden name degree + marriage certificate (apostilled)</li>
                            <li>❌ Degree in Latin → Get English version or official translation first</li>
                            <li>❌ Associate's degree (2-year) → Not acceptable; must be Bachelor's (4-year)</li>
                        </ul>
                    </div>

                    <h3>2.3 Self-Health Statement</h3>

                    <p><strong>What It Is:</strong> Pre-arrival health questionnaire about communicable diseases, mental health, drug use.</p>

                    <p><strong>Where to Get:</strong></p>
                    <ul>
                        <li>Download from Korean consulate website, or</li>
                        <li>Your employer will provide, or</li>
                        <li>Korea Visa Portal (visa.go.kr)</li>
                    </ul>

                    <div class="alert alert-warning">
                        <p><strong>✅ IMPORTANT:</strong> Be truthful. False statements = deportation if discovered.</p>
                        <p><strong>❌ WARNING:</strong> This is NOT your final health check. You'll do a full medical screening in Korea within 90 days.</p>
                    </div>

                    <p><strong>No Notarization or Apostille Required</strong></p>

                    <h3>2.4 Passport Photos</h3>

                    <p><strong>Specifications:</strong></p>
                    <ul>
                        <li>Size: <strong>2×2 inches</strong> (U.S. standard) or <strong>3.5×4.5cm</strong> (Korea standard)</li>
                        <li>Background: White</li>
                        <li>Recent: Taken within 6 months</li>
                        <li>Requirements: No glasses, no hat, facing forward</li>
                        <li>Color photos</li>
                    </ul>

                    <p><strong>Where to Get:</strong> CVS Pharmacy, Walgreens, UPS Store, Costco, Passport photo booths</p>

                    <p><strong>How Many:</strong> Get 6-8 total copies</p>

                    <p><strong>Cost:</strong> $10-20 for 6-8 photos</p>
                `
            },
            {
                id: 'action-plan',
                title: '6. Action Plan – 2-3 Week Timeline',
                content: `
                    <h3>WEEK 1: FBI Channeler + Document Collection</h3>

                    <h4>Day 1-2: FBI Channeler Appointment</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="w1-channeler" onchange="toggleCheckbox('w1-channeler')">
                            <label for="w1-channeler">Select channeler: Visit accuratebiometrics.com</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w1-location" onchange="toggleCheckbox('w1-location')">
                            <label for="w1-location">Find location: 825+ locations nationwide</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w1-book" onchange="toggleCheckbox('w1-book')">
                            <label for="w1-book">Book appointment: Online scheduling available</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w1-attend" onchange="toggleCheckbox('w1-attend')">
                            <label for="w1-attend">Attend appointment: Digital fingerprints (5 min), Pay $40-100</label>
                        </li>
                    </ul>

                    <h4>Day 2-4: Receive FBI Results</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="w1-email" onchange="toggleCheckbox('w1-email')">
                            <label for="w1-email">Check email: PDF typically arrives in 24-72 hours</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w1-verify" onchange="toggleCheckbox('w1-verify')">
                            <label for="w1-verify">Verify: FBI CJIS seal visible, name matches passport</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w1-forward" onchange="toggleCheckbox('w1-forward')">
                            <label for="w1-forward">Forward: Immediately send PDF to Monument Visa</label>
                        </li>
                    </ul>

                    <h4>Day 1: Degree Notarization</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="w1-degree" onchange="toggleCheckbox('w1-degree')">
                            <label for="w1-degree">Locate degree: Find your Bachelor's diploma</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w1-notary" onchange="toggleCheckbox('w1-notary')">
                            <label for="w1-notary">Get notarized: Request "notarized true copy"</label>
                        </li>
                    </ul>

                    <h4>Day 1: Passport Photos</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="w1-photos" onchange="toggleCheckbox('w1-photos')">
                            <label for="w1-photos">Get photos: Visit CVS, Walgreens, or UPS Store (6-8 copies)</label>
                        </li>
                    </ul>

                    <h3>WEEK 2-3: Monument Visa Professional Apostille Service</h3>

                    <h4>Day 7-8: Contact Monument Visa</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="w2-contact" onchange="toggleCheckbox('w2-contact')">
                            <label for="w2-contact">Visit monumentvisa.com and contact for services</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w2-quote" onchange="toggleCheckbox('w2-quote')">
                            <label for="w2-quote">Get quote: Federal apostille for FBI + State apostille for degree</label>
                        </li>
                    </ul>

                    <h4>Day 8: Submit Documents to Monument Visa</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="w2-email-fbi" onchange="toggleCheckbox('w2-email-fbi')">
                            <label for="w2-email-fbi">Email FBI PDF to Monument Visa</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w2-ship-degree" onchange="toggleCheckbox('w2-ship-degree')">
                            <label for="w2-ship-degree">FedEx overnight notarized degree to Monument Visa</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w2-pay" onchange="toggleCheckbox('w2-pay')">
                            <label for="w2-pay">Pay: $300-400 by credit card</label>
                        </li>
                    </ul>

                    <h4>Day 13-15: Receive Apostilled Documents</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="w2-receive" onchange="toggleCheckbox('w2-receive')">
                            <label for="w2-receive">Receive package: FBI with Federal apostille + Degree with State apostille</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w2-verify-apostille" onchange="toggleCheckbox('w2-verify-apostille')">
                            <label for="w2-verify-apostille">Verify: Apostilles stapled securely (DO NOT REMOVE staples)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w2-scan" onchange="toggleCheckbox('w2-scan')">
                            <label for="w2-scan">Scan both apostilled documents (front and back)</label>
                        </li>
                    </ul>

                    <h3>WEEK 3: Pack & Ship to Korea</h3>

                    <h4>Day 15-16: Final Document Assembly</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="w3-assemble" onchange="toggleCheckbox('w3-assemble')">
                            <label for="w3-assemble">Organize documents in correct order</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w3-pack" onchange="toggleCheckbox('w3-pack')">
                            <label for="w3-pack">Pack carefully in rigid mailer (do NOT fold documents)</label>
                        </li>
                    </ul>

                    <h4>Day 16-17: Ship to Korea</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="w3-ship" onchange="toggleCheckbox('w3-ship')">
                            <label for="w3-ship">Ship via FedEx/DHL/UPS (NOT USPS) with tracking</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="w3-notify" onchange="toggleCheckbox('w3-notify')">
                            <label for="w3-notify">Email tracking number to employer and Kang & Kriel</label>
                        </li>
                    </ul>
                `
            },
            {
                id: 'interactive-timeline',
                title: '7. Interactive Timeline – Track Your Progress',
                content: `
                    <div class="alert alert-info">
                        <p><strong>Use this interactive timeline to track your progress through each week.</strong> Check off tasks as you complete them!</p>
                    </div>

                    <div id="timeline-container"></div>
                `
            },
            {
                id: 'quality-gate',
                title: '8. Quality Gate – Final Verification Before Shipping',
                content: `
                    <div class="alert alert-warning">
                        <h3>⚠️ STOP! Verify Before Shipping</h3>
                        <p><strong>Before you ship documents to Korea, complete this quality gate.</strong></p>
                        <p>One error = weeks of delay. Take 30 minutes to verify everything.</p>
                    </div>

                    <h3>Document Quality Checks</h3>

                    <h4>☐ FBI Background Check:</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-1">
                            <label for="qg-1">Name matches passport exactly (including middle names)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-2">
                            <label for="qg-2">Issued within last 6 months</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-3">
                            <label for="qg-3">FBI CJIS seal visible</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-4">
                            <label for="qg-4"><strong>Federal apostille</strong> (U.S. Department of State) stapled</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-5">
                            <label for="qg-5">Apostille intact (staple not removed)</label>
                        </li>
                    </ul>

                    <h4>☐ Bachelor's Degree:</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-6">
                            <label for="qg-6">Name matches passport exactly</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-7">
                            <label for="qg-7">Bachelor's degree (4-year minimum)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-8">
                            <label for="qg-8">Notarized as "true copy"</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-9">
                            <label for="qg-9"><strong>State apostille</strong> (Secretary of State of degree-issuing state) stapled</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-10">
                            <label for="qg-10">Apostille intact</label>
                        </li>
                    </ul>

                    <h4>☐ All Documents:</h4>
                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-11">
                            <label for="qg-11">No tears, stains, or damage</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-12">
                            <label for="qg-12">Text is clearly legible</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-13">
                            <label for="qg-13">All signatures present where required</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-14">
                            <label for="qg-14">All dates within valid periods</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-15">
                            <label for="qg-15">All names spelled consistently across documents</label>
                        </li>
                    </ul>

                    <h3>Scans & Backups</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-16">
                            <label for="qg-16">High-resolution scans of all documents (front and back)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-17">
                            <label for="qg-17">Saved to cloud storage (Google Drive, Dropbox)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-18">
                            <label for="qg-18">Saved to local computer/external drive</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-19">
                            <label for="qg-19">Shared with employer (optional but helpful)</label>
                        </li>
                    </ul>

                    <h3>Packing Verification</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-20">
                            <label for="qg-20">Correct document order (FBI, degree, health, passport, contract, resume, photos)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-21">
                            <label for="qg-21">Nothing folded or bent</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-22">
                            <label for="qg-22">Photos protected in sleeve</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-23">
                            <label for="qg-23">Rigid mailer used</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-24">
                            <label for="qg-24">Securely sealed</label>
                        </li>
                    </ul>

                    <h3>Shipping Verification</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-25">
                            <label for="qg-25">Using FedEx, DHL, or UPS (NOT USPS)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-26">
                            <label for="qg-26">2-5 day international service selected</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-27">
                            <label for="qg-27">Tracking number obtained</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-28">
                            <label for="qg-28">Employer's Korea address confirmed correct</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-29">
                            <label for="qg-29">Your contact info included in package</label>
                        </li>
                    </ul>

                    <h3>After Shipping</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-30">
                            <label for="qg-30">Tracking number emailed to employer</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-31">
                            <label for="qg-31">Tracking number emailed to Kang & Kriel</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="qg-32">
                            <label for="qg-32">Daily monitoring until delivery confirmed</label>
                        </li>
                    </ul>

                    <div class="alert alert-success">
                        <h3>✅ All Checked? Ready to Ship!</h3>
                        <p><strong>You've completed the quality gate.</strong> Your documents are ready for shipment to Korea.</p>
                        <p>Proceed to Section 10 (Packing & Shipping) for final instructions.</p>
                    </div>

                    <div class="alert alert-danger">
                        <h3>❌ Found Issues?</h3>
                        <p><strong>DO NOT SHIP.</strong> Resolve all issues first:</p>
                        <ul>
                            <li><strong>Name mismatch:</strong> Get corrected documents before shipping</li>
                            <li><strong>Wrong apostille type:</strong> Re-order correct apostille</li>
                            <li><strong>Damaged documents:</strong> Request new copies</li>
                            <li><strong>Missing signatures:</strong> Sign all required forms</li>
                        </ul>
                        <p>Need help? Contact Kang & Kriel before shipping.</p>
                    </div>
                `
            },
            {
                id: 'red-flags',
                title: '9. Red Flags – Common Rejection Reasons',
                content: `
                    <div class="alert alert-danger">
                        <h3>⚠️ Korean Immigration is Strict</h3>
                        <p>These errors cause <strong>immediate rejection</strong>. Review carefully before shipping!</p>
                    </div>

                    <h3>FBI Background Check Red Flags</h3>
                    <ul>
                        <li>❌ <strong>State or local police check</strong> → Must be FBI national check</li>
                        <li>❌ <strong>State apostille on FBI check</strong> → Must be Federal (U.S. Dept of State)</li>
                        <li>❌ <strong>Older than 6 months</strong> → Count from CCVI application date</li>
                        <li>❌ <strong>Name doesn't match passport</strong> → Even slight differences rejected</li>
                        <li>❌ <strong>Missing FBI seal/signature</strong> → Must show FBI CJIS certification</li>
                        <li>❌ <strong>Photocopied apostille</strong> → Must be original apostille, not copy</li>
                        <li>❌ <strong>Removed staples</strong> → Looks like tampering</li>
                        <li>❌ <strong>Criminal record</strong> → DUI, drugs, violence = likely rejection</li>
                    </ul>

                    <h3>Degree Red Flags</h3>
                    <ul>
                        <li>❌ <strong>Federal apostille on degree</strong> → Must be State apostille</li>
                        <li>❌ <strong>Associate's or 3-year degree</strong> → Must be 4-year Bachelor's minimum</li>
                        <li>❌ <strong>Diploma in Latin</strong> → Must have English translation</li>
                        <li>❌ <strong>Unnotarized copy</strong> → Must be notarized "true copy" before apostille</li>
                        <li>❌ <strong>Name mismatch with passport</strong> → Middle names matter</li>
                        <li>❌ <strong>Unaccredited school</strong> → Verify school's accreditation</li>
                        <li>❌ <strong>Degree from diploma mill</strong> → Korea scrutinizes online-only degrees</li>
                    </ul>

                    <h3>Application Red Flags</h3>
                    <ul>
                        <li>❌ <strong>Unsigned visa application</strong> → Automatic rejection</li>
                        <li>❌ <strong>Expired passport</strong> → Must have 6+ months validity</li>
                        <li>❌ <strong>Incomplete document pack</strong> → Missing documents delay weeks</li>
                        <li>❌ <strong>Wrong consulate</strong> → Must apply in your residence jurisdiction</li>
                        <li>❌ <strong>Altered documents</strong> → Any tampering = rejection</li>
                        <li>❌ <strong>Incorrect VIN</strong> → One wrong digit = rejection (double-check)</li>
                    </ul>

                    <h3>Health Check Red Flags (After Arrival)</h3>
                    <ul>
                        <li>❌ <strong>Positive drug test</strong> → Marijuana, CBD = deportation</li>
                        <li>❌ <strong>Active tuberculosis</strong> → Requires treatment</li>
                        <li>❌ <strong>Undisclosed conditions</strong> → False health statements = deportation</li>
                    </ul>

                    <div class="alert alert-success">
                        <h3>✅ Prevention Checklist</h3>
                        <ol>
                            <li>Use Section 8 Quality Gate before shipping</li>
                            <li>Have another person verify names/dates</li>
                            <li>Don't remove apostille staples</li>
                            <li>Keep scanned copies of everything</li>
                            <li>If unsure, ask Kang & Kriel before shipping</li>
                        </ol>
                    </div>
                `
            },
            {
                id: 'packing-shipping',
                title: '10. Packing & Shipping – Safe Delivery to Korea',
                content: `
                    <h3>Document Order (Top to Bottom)</h3>
                    <ol>
                        <li>✅ FBI Identity History Summary with <strong>Federal apostille</strong> stapled</li>
                        <li>✅ Bachelor's degree copy with <strong>State apostille</strong> stapled</li>
                        <li>✅ Self-Health Statement (signed and dated)</li>
                        <li>✅ Passport bio page copy (color, high-res)</li>
                        <li>✅ Signed employment contract (original)</li>
                        <li>✅ Resume/CV (signed and dated)</li>
                        <li>✅ 2-4 passport photos (in small envelope)</li>
                    </ol>

                    <h3>Packing Rules</h3>

                    <div class="alert alert-success">
                        <h4>✅ DO:</h4>
                        <ul>
                            <li>Use rigid cardboard mailer (documents lay flat)</li>
                            <li>Place photos in protective sleeve</li>
                            <li>Include cover memo with your contact info</li>
                            <li>Seal securely with packing tape</li>
                        </ul>
                    </div>

                    <div class="alert alert-danger">
                        <h4>❌ DON'T:</h4>
                        <ul>
                            <li>Don't use regular envelope (documents will bend)</li>
                            <li>Don't fold any documents</li>
                            <li>Don't glue photos directly</li>
                            <li>Don't remove apostille staples</li>
                            <li>Don't send your original passport to Korea</li>
                        </ul>
                    </div>

                    <h3>Shipping Requirements</h3>

                    <div class="card-grid">
                        <div class="card">
                            <h4>✅ Use ONLY These Couriers:</h4>
                            <ul>
                                <li>FedEx International Priority</li>
                                <li>DHL Express Worldwide</li>
                                <li>UPS Worldwide Expedited</li>
                            </ul>
                            <p><strong>Service Level:</strong></p>
                            <ul>
                                <li>2-5 business day delivery</li>
                                <li>Tracking included</li>
                                <li>Signature required on delivery</li>
                            </ul>
                            <p><strong>Cost:</strong> $40-80</p>
                        </div>
                        <div class="card">
                            <h4>❌ NEVER Use:</h4>
                            <ul>
                                <li>USPS International (unreliable tracking in Korea)</li>
                                <li>Purolator (poor Korea tracking)</li>
                                <li>Any service without full tracking</li>
                            </ul>
                        </div>
                    </div>

                    <h3>Tracking Protocol</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="track-1">
                            <label for="track-1">Get tracking number at shipping</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="track-2">
                            <label for="track-2">Email tracking # to Korean employer immediately</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="track-3">
                            <label for="track-3">Email tracking # to Kang & Kriel</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="track-4">
                            <label for="track-4">Save tracking # in safe place</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="track-5">
                            <label for="track-5">Monitor daily until Korea delivery confirmed</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="track-6">
                            <label for="track-6">Employer confirms receipt and reviews contents</label>
                        </li>
                    </ul>

                    <div class="alert alert-warning">
                        <h4>⚠️ If Tracking Shows Issues:</h4>
                        <ul>
                            <li><strong>Package delayed:</strong> Contact courier immediately</li>
                            <li><strong>Customs hold:</strong> Employer may need to provide documents</li>
                            <li><strong>Wrong address:</strong> Contact courier and employer to redirect</li>
                        </ul>
                    </div>
                `
            },
            {
                id: 'vin-process',
                title: '11. VIN Process – Complete Visa Issuance Guide',
                content: `
                    <h3>After Your Employer Receives Documents</h3>

                    <div class="alert alert-info">
                        <h4>Employer's Steps:</h4>
                        <ol>
                            <li>Takes documents to local Immigration Office (출입국관리사무소)</li>
                            <li>Submits CCVI application</li>
                            <li>Immigration reviews (~7-10 business days)</li>
                            <li>If approved: VIN issued</li>
                            <li>Employer emails VIN to you</li>
                        </ol>
                    </div>

                    <div class="card">
                        <h4>📋 VIN Format</h4>
                        <p><strong>4 letters + 8 numbers</strong></p>
                        <p>Example: UJBO 08007392</p>
                        <p><strong>Validity:</strong> 3 months from issue date, single use</p>
                    </div>

                    <h3>What You Do With VIN</h3>

                    <h4>Step 1: Verify VIN</h4>
                    <ul>
                        <li>✅ Check format: 4 letters + 8 numbers</li>
                        <li>✅ Verify name spelling matches your passport</li>
                        <li>✅ Save PDF/email with VIN</li>
                    </ul>

                    <h4>Step 2: Complete Visa Application</h4>
                    <ul>
                        <li>Download form from your consulate or visa.go.kr</li>
                        <li>Fill completely</li>
                        <li>Enter VIN exactly (double-check every character)</li>
                        <li>Attach 1 passport photo</li>
                        <li><strong>SIGN the form</strong> (unsigned = automatic rejection)</li>
                    </ul>

                    <h4>Step 3: Submit to Consulate</h4>

                    <div class="card-grid">
                        <div class="card">
                            <h4>✅ In-Person (Recommended)</h4>
                            <ul>
                                <li>Visit during visa hours (typically 9 AM - 12 PM, Mon-Fri)</li>
                                <li>Bring: passport, completed application, VIN printout, photo, fee ($45), driver's license</li>
                                <li>Staff verifies documents immediately</li>
                                <li>Processing: 2-5 business days</li>
                                <li>Return to pick up passport with visa</li>
                            </ul>
                        </div>
                        <div class="card">
                            <h4>📬 Mail-In</h4>
                            <ul>
                                <li>Mail: passport, application, VIN, photo, money order fee, return envelope</li>
                                <li>Use certified mail with tracking</li>
                                <li>Processing: 5-10 days + mail time</li>
                                <li>Passport with visa returns by mail</li>
                            </ul>
                        </div>
                    </div>

                    <h4>Step 4: Receive E-2 Visa</h4>
                    <ul>
                        <li>✅ Verify visa details: type (E-2), validity (13 months), entries (multiple)</li>
                        <li>✅ Make copies of visa page</li>
                        <li>✅ Scan to digital backup</li>
                        <li>✅ Notify employer: "Visa received, booking flight"</li>
                    </ul>

                    <div class="alert alert-success">
                        <h4>🎉 Congratulations!</h4>
                        <p>You now have your E-2 visa. Book your flight and prepare for your Korean adventure!</p>
                    </div>
                `
            },
            {
                id: 'after-arrival',
                title: '12. 🚨 Critical First Week in Korea – Immediate Actions Required',
                content: `
                    <div class="alert alert-danger" style="border-left: 8px solid #dc2626;">
                        <h3>🚨 REALITY CHECK: 90 Days vs. 7 Days</h3>
                        <div style="background: rgba(255,255,255,0.95); padding: 20px; border-radius: 8px; margin: 15px 0;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div style="padding: 15px; background: #e2e8f0; border-radius: 8px;">
                                    <h4 style="color: #991b1b; margin-top: 0;">❌ What You'll Read Online</h4>
                                    <ul style="margin: 10px 0; color: #991b1b;">
                                        <li>"You have 90 days to get your ARC"</li>
                                        <li>"Take your time settling in"</li>
                                        <li>"No rush on registration"</li>
                                    </ul>
                                </div>
                                <div style="padding: 15px; background: #dcfce7; border-radius: 8px;">
                                    <h4 style="color: #166534; margin-top: 0;">✅ E-2 Teacher Reality</h4>
                                    <ul style="margin: 10px 0; color: #166534;">
                                        <li>Need to start teaching immediately</li>
                                        <li>Education office requires ARC receipt</li>
                                        <li>No registration = No salary</li>
                                    </ul>
                                </div>
                            </div>
                            <p style="margin-top: 15px; padding: 15px; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 4px;">
                                <strong style="color: #92400e;">The Truth:</strong> While immigration law gives you 90 days for ARC, education offices require it (or the application receipt) to register you as a teacher. Without education office registration, you cannot legally teach or receive salary.
                            </p>
                        </div>
                    </div>

                    <div class="alert alert-danger">
                        <h3>🔴 CRITICAL: Drug Screening Warning</h3>
                        <p><strong>⚠️ MANDATORY HEALTH SCREENING INCLUDES DRUG TEST</strong></p>
                        <p>All E-2 visa holders must complete health screening within 90 days of arrival.</p>

                        <h4>Tests Performed:</h4>
                        <ul>
                            <li>Blood test (HIV, syphilis, general health)</li>
                            <li><strong>Urine test (drug screening: marijuana/THC, methamphetamine, cocaine, opiates)</strong></li>
                            <li>Chest X-ray (tuberculosis)</li>
                            <li>Physical exam (blood pressure, vision)</li>
                        </ul>

                        <h4>MARIJUANA WARNING:</h4>
                        <ul>
                            <li>Marijuana is <strong>STRICTLY ILLEGAL</strong> in Korea</li>
                            <li>Even if legal in your U.S. state</li>
                            <li>THC remains in system <strong>2 weeks to 3 months</strong></li>
                            <li><strong>Positive test = immediate consequences:</strong>
                                <ul>
                                    <li>✖ Visa cancellation</li>
                                    <li>✖ Job termination</li>
                                    <li>✖ Health insurance loss</li>
                                    <li>✖ Deportation</li>
                                    <li>✖ Ban from future entry to Korea</li>
                                </ul>
                            </li>
                        </ul>

                        <p><strong>Action Required:</strong></p>
                        <ul>
                            <li>Stop all marijuana/THC products at least 3 months before departure</li>
                            <li>No exceptions for medical marijuana</li>
                            <li>No appeals for positive results</li>
                        </ul>
                    </div>

                    <h3>Week 1-2: Health Screening (HIGHEST PRIORITY)</h3>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="korea-health" onchange="toggleCheckbox('korea-health')">
                            <label for="korea-health">Complete health screening at designated hospital</label>
                        </li>
                    </ul>

                    <p><strong>Where:</strong> Designated hospitals only (employer provides list)</p>
                    <ul>
                        <li>Seoul: Severance Hospital, Samsung Medical Center, Asan Medical Center</li>
                        <li>Other cities: International clinics approved by immigration</li>
                    </ul>

                    <p><strong>What to Bring:</strong></p>
                    <ul>
                        <li>Passport with E-2 visa</li>
                        <li>2 passport photos</li>
                        <li>Payment (~₩80,000-150,000 / $60-115) – often employer pays</li>
                    </ul>

                    <h3>Within 14 Days: Address Registration (MANDATORY)</h3>

                    <div class="alert alert-danger">
                        <p><strong>✅ LEGAL REQUIREMENT:</strong> ₩100,000-1,000,000 fine if missed</p>
                    </div>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="korea-address" onchange="toggleCheckbox('korea-address')">
                            <label for="korea-address">Register address at local district office</label>
                        </li>
                    </ul>

                    <p><strong>Where:</strong> Local district office (구청), Neighborhood center (읍/면/동 사무소), or Immigration office</p>

                    <p><strong>What to Bring:</strong></p>
                    <ul>
                        <li>Passport with E-2 visa</li>
                        <li>Rental contract or housing letter from employer</li>
                        <li>Registration form (provided at office)</li>
                    </ul>

                    <h3>🚨 IMMEDIATE: ARC Application (Within First Week, NOT 90 Days!)</h3>

                    <div class="alert alert-warning" style="margin-bottom: 20px;">
                        <h4 style="margin-top: 0;">⚠️ Critical Timeline Correction</h4>
                        <p><strong>Legal requirement:</strong> 90 days from arrival</p>
                        <p><strong>YOUR requirement:</strong> Within 3-5 days of arrival</p>
                        <p><strong>Why the rush?</strong> Education offices require your ARC application receipt to register you as a teacher. Without that registration, you cannot legally work or receive salary.</p>
                    </div>

                    <ul class="checklist">
                        <li class="checklist-item">
                            <input type="checkbox" id="korea-arc" onchange="toggleCheckbox('korea-arc')">
                            <label for="korea-arc"><strong>PRIORITY:</strong> Apply for ARC at Immigration Office (Day 3-5 after arrival)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="korea-arc-receive" onchange="toggleCheckbox('korea-arc-receive')">
                            <label for="korea-arc-receive">Return to collect ARC (2-3 weeks later)</label>
                        </li>
                        <li class="checklist-item">
                            <input type="checkbox" id="korea-moe-registration" onchange="toggleCheckbox('korea-moe-registration')">
                            <label for="korea-moe-registration"><strong>CRITICAL:</strong> Education Office Teacher Registration (Day 7-10, using ARC receipt)</label>
                        </li>
                    </ul>

                    <p><strong>Why Essential (Beyond the 90-day rule):</strong></p>
                    <ul>
                        <li><strong>🎓 Education office registration</strong> (MOST CRITICAL - required to teach)</li>
                        <li>Bank account (can open with ARC receipt)</li>
                        <li>Phone contract (can register with ARC receipt)</li>
                        <li>Online purchases requiring Korean ID</li>
                        <li>Gym memberships</li>
                        <li>Domestic travel bookings</li>
                    </ul>

                    <p><strong>Required Documents:</strong></p>
                    <ol>
                        <li>Passport with E-2 visa</li>
                        <li>Health check results (건강진단서) - from designated hospital</li>
                        <li>ARC application form (Form 34 - available at immigration office)</li>
                        <li>2 passport photos (3.5×4.5cm, white background)</li>
                        <li>Housing contract OR employer confirmation letter</li>
                        <li>Employment contract (optional but helpful)</li>
                        <li>Fee: ₩39,000 (~$30) - ₩35,000 발급 + ₩4,000 우편 배송 - cash or card</li>
                    </ol>

                    <div class="alert alert-success" style="margin-top: 15px;">
                        <h4 style="margin-top: 0;">💡 Key Insight: The ARC Receipt (접수증)</h4>
                        <p>After applying for your ARC, you'll receive an application receipt (접수증, "jeopseujeung"). <strong>This receipt is accepted by:</strong></p>
                        <ul>
                            <li>✅ Banks (to open accounts)</li>
                            <li>✅ Phone companies (to register service)</li>
                            <li>✅ <strong>Education offices (to register as a teacher)</strong></li>
                        </ul>
                        <p><strong>You don't need to wait 2-3 weeks for the physical card!</strong> Start these processes immediately after getting your receipt.</p>
                    </div>

                    <h3>📅 Your Actual First Week Timeline</h3>

                    <table style="margin: 20px 0;">
                        <thead>
                            <tr>
                                <th>Day</th>
                                <th>Task</th>
                                <th>Why Critical</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #f1f5f9;">
                                <td><strong>1-2</strong></td>
                                <td>Health check at MOJ designated hospital</td>
                                <td>Required for ARC application</td>
                            </tr>
                            <tr style="background: #f1f5f9;">
                                <td><strong>3-5</strong></td>
                                <td>Apply for ARC at immigration office</td>
                                <td>Get receipt for education office</td>
                            </tr>
                            <tr style="background: #dbeafe;">
                                <td><strong>7-10</strong></td>
                                <td>Education office teacher registration</td>
                                <td>Required to legally teach and receive salary</td>
                            </tr>
                            <tr>
                                <td><strong>14-21</strong></td>
                                <td>Collect physical ARC card</td>
                                <td>Primary ID for daily life in Korea</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Employment & Legal Restrictions</h3>

                    <div class="alert alert-warning">
                        <h4>Your E-2 Visa Means:</h4>
                        <ul>
                            <li>✅ You can work for your sponsored employer</li>
                            <li>✅ You can travel in/out of Korea (multiple entry)</li>
                            <li>❌ You CANNOT do private tutoring (엄격히 불법)</li>
                            <li>❌ You CANNOT work for other employers without approval</li>
                            <li>❌ You CANNOT change jobs without immigration permission</li>
                        </ul>

                        <p><strong>Private Tutoring is ILLEGAL for E-2 Holders:</strong></p>
                        <ul>
                            <li>Penalties: Up to ₩30,000,000 fine (~$23,000)</li>
                            <li>Deportation</li>
                            <li>1-10 year entry ban to Korea</li>
                        </ul>
                    </div>
                `
            },
            {
                id: 'faq',
                title: '13. FAQ – Common Questions & Scenarios',
                content: `
                    <h3>🚨 Q. I read online that I have 90 days to register for ARC. Why do I need to rush?</h3>
                    <div class="alert alert-warning" style="margin: 15px 0;">
                        <p><strong>A.</strong> This is THE most common misconception for E-2 teachers.</p>

                        <p><strong>The 90-day rule is technically correct</strong> according to immigration law. However:</p>
                        <ul>
                            <li>🎓 <strong>Education offices require ARC (or application receipt)</strong> to register you as a teacher</li>
                            <li>📝 <strong>Schools cannot legally employ you</strong> until you're registered with the education office</li>
                            <li>💰 <strong>You cannot receive salary</strong> until you're officially registered</li>
                            <li>⏰ <strong>Most E-2 teachers need to start teaching</strong> within 1-2 weeks of arrival</li>
                        </ul>

                        <p style="margin-top: 15px;"><strong>Following the "90-day rule" will:</strong></p>
                        <ul>
                            <li>❌ Delay your employment start date</li>
                            <li>❌ Delay your first salary payment (possibly by months)</li>
                            <li>❌ Create friction with your school/employer</li>
                            <li>❌ Put you in a legal gray area if you start teaching before registration</li>
                        </ul>

                        <p style="margin-top: 15px; padding: 15px; background: #dcfce7; border-radius: 6px;">
                            <strong style="color: #166534;">✅ The Reality:</strong> Apply for ARC within 3-5 days of arrival → Get receipt → Register with education office within 7-10 days → Start teaching legally with salary processing in place.
                        </p>
                    </div>

                    <h3>Q. Can I start teaching before getting my ARC?</h3>
                    <div class="alert alert-info" style="margin: 15px 0;">
                        <p><strong>A.</strong> Technically no, but practically <strong>yes with the ARC application receipt:</strong></p>
                        <ul>
                            <li>✅ You can register with education office using just the <strong>receipt (접수증)</strong></li>
                            <li>✅ Once registered with education office, you can legally start teaching</li>
                            <li>✅ You don't need to wait for the physical ARC card</li>
                            <li>⏱️ ARC card arrives 1-2 weeks later (you'll return to immigration to collect it)</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>This is why you must apply for ARC immediately after arrival!</strong></p>
                    </div>

                    <h3>Q. What if my school says "it's okay, take your time" with the ARC?</h3>
                    <div class="alert alert-warning" style="margin: 15px 0;">
                        <p><strong>A.</strong> Your school HR might not understand the urgency or the education office requirements. Politely but firmly insist:</p>
                        <blockquote style="background: #f3f4f6; padding: 15px; border-left: 4px solid var(--primary-500); margin: 15px 0; font-style: italic;">
                            "I understand there's a 90-day window for immigration, but I need to register with the education office to start teaching legally and ensure timely salary processing. Can we prioritize scheduling the health check and ARC application this week?"
                        </blockquote>
                        <p>If they still resist, ask them to:</p>
                        <ul>
                            <li>📞 Contact the education office directly to confirm ARC requirements for teacher registration</li>
                            <li>📋 Clarify when you'll be registered with the education office</li>
                            <li>💰 Confirm when salary processing will begin</li>
                        </ul>
                    </div>

                    <h3>Q. What happens if I delay the ARC application?</h3>
                    <div class="alert alert-danger" style="margin: 15px 0;">
                        <p><strong>A. Potential consequences:</strong></p>
                        <ul>
                            <li>❌ <strong>Cannot officially register with education office</strong> → Cannot legally teach</li>
                            <li>❌ <strong>Salary processing delayed</strong> (sometimes by months, requires retroactive paperwork)</li>
                            <li>❌ <strong>Teaching without registration is technically illegal</strong> → Visa complications</li>
                            <li>❌ <strong>Contract disputes with school</strong> → They expect you to start on time</li>
                            <li>❌ <strong>Visa renewal complications</strong> → Gaps in legal employment status</li>
                        </ul>
                    </div>

                    <h3>Q. Can I use my passport instead of ARC for daily tasks?</h3>
                    <div class="alert alert-info" style="margin: 15px 0;">
                        <p><strong>A.</strong> For some things yes, but not for education office registration:</p>
                        <table style="margin: 15px 0;">
                            <thead>
                                <tr>
                                    <th>Service</th>
                                    <th>Passport OK?</th>
                                    <th>ARC/Receipt Required?</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Hotel check-in</td>
                                    <td style="color: #22c55e; font-weight: bold;">✅ Yes</td>
                                    <td>No</td>
                                </tr>
                                <tr>
                                    <td>Bank account (basic)</td>
                                    <td style="color: #f59e0b; font-weight: bold;">⚠️ Temporary</td>
                                    <td>For full service</td>
                                </tr>
                                <tr>
                                    <td>Phone contract</td>
                                    <td style="color: #f59e0b; font-weight: bold;">⚠️ Limited</td>
                                    <td>For best plans</td>
                                </tr>
                                <tr style="background: #dbeafe;">
                                    <td><strong>Education Office Registration</strong></td>
                                    <td style="color: #dc2626; font-weight: bold;">❌ NO</td>
                                    <td style="color: #22c55e; font-weight: bold;">✅ MANDATORY</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Q. I have a DUI/misdemeanor. Can I get an E-2 visa?</h3>
                    <p><strong>A.</strong> It depends on severity and type.</p>

                    <p><strong>Generally acceptable:</strong></p>
                    <ul>
                        <li>Minor traffic violations (speeding tickets, parking)</li>
                        <li>Very old non-violent misdemeanors (10+ years ago)</li>
                    </ul>

                    <p><strong>Usually rejected:</strong></p>
                    <ul>
                        <li>DUI/DWI (especially recent)</li>
                        <li>Drug offenses (any type, any time)</li>
                        <li>Violent crimes</li>
                        <li>Crimes involving moral turpitude</li>
                        <li>Sex offenses</li>
                    </ul>

                    <hr>

                    <h3>Q. Can I reuse an FBI check I got 8 months ago?</h3>
                    <p><strong>A.</strong> No. FBI check must be issued within <strong>6 months</strong> of when employer applies for CCVI.</p>
                    <p>You need a new one. Good news: FBI channeler + Monument Visa = new apostilled FBI check in 1 week.</p>

                    <hr>

                    <h3>Q. What if I'm currently outside the U.S.?</h3>
                    <p><strong>A.</strong> You need a U.S. address for FBI check delivery. Options:</p>
                    <ol>
                        <li>Use channeler + U.S. friend/family address</li>
                        <li>Friend/family mails FBI result to Monument Visa</li>
                        <li>Monument Visa ships apostilled docs internationally</li>
                        <li>OR: Fly to U.S. for 2-3 weeks to complete process in person</li>
                    </ol>

                    <hr>

                    <h3>Q. Can my spouse/kids come with me?</h3>
                    <p><strong>A.</strong> Yes, on F-3 dependent visas. But:</p>
                    <ul>
                        <li>They need separate visa applications</li>
                        <li>Additional documents required (marriage certificate, birth certificates – all apostilled)</li>
                        <li>They cannot work in Korea</li>
                        <li>Consider if single income is sufficient</li>
                    </ul>

                    <hr>

                    <h3>Q. I have tattoos. Will this affect my visa?</h3>
                    <p><strong>A.</strong> Visa: No impact on approval</p>
                    <p>Employment: Depends on employer</p>
                    <ul>
                        <li>Public schools (EPIK): Generally okay if coverable</li>
                        <li>Private academies: Varies by location</li>
                        <li>Kindergartens: May have restrictions</li>
                    </ul>

                    <hr>

                    <h3>Q. Can I work while waiting for ARC?</h3>
                    <p><strong>A.</strong> Technically yes if you entered on E-2 visa – BUT you must pass health check first.</p>

                    <hr>

                    <h3>Q. Can I extend my E-2 visa without leaving Korea?</h3>
                    <p><strong>A.</strong> Yes, if renewing with same employer:</p>
                    <ul>
                        <li>Submit extension 30-60 days before expiration</li>
                        <li>Need: new contract, health insurance proof, clean tax records</li>
                        <li>Processing: ~2 weeks</li>
                        <li>No need to return to U.S.</li>
                    </ul>

                    <hr>

                    <h3>Q. My degree is from a foreign university, not U.S. Can I apply?</h3>
                    <p><strong>A.</strong> Yes, but requires extra steps:</p>
                    <ol>
                        <li>Get credential evaluation from NACES member (WES, ECE)</li>
                        <li>Evaluation must show equivalency to U.S. Bachelor's</li>
                        <li>Evaluation report needs notarization + State apostille</li>
                        <li>Adds ~$200-300 cost and 2-4 weeks</li>
                        <li>Some Korean employers may not accept – verify first</li>
                    </ol>
                `
            },
            {
                id: 'templates',
                title: '14. Templates – Sample Documents & Forms',
                content: `
                    <h3>Document Templates</h3>
                    <p>Use these templates as guides for preparing your documents.</p>

                    <div class="card">
                        <h4>📄 Cover Letter Template (for shipping package)</h4>
                        <pre>
[Your Name]
[Your Email]
[Your Phone Number]
[Date]

To: [Employer Name]
[School/Company Name]
[Korea Address]

Re: E-2 Visa Document Package - [Your Full Name]

Dear [Employer Name],

Enclosed please find my complete E-2 visa document package:

1. FBI Identity History Summary with Federal apostille
2. Bachelor's degree (notarized copy) with State apostille
3. Self-Health Statement (signed)
4. Passport bio page copy
5. Signed employment contract
6. Resume/CV (signed)
7. Passport photos (6 copies)

Tracking Number: [Insert FedEx/DHL/UPS tracking]

Please confirm receipt and review of all documents.
Contact me immediately if anything is missing or unclear.

Best regards,
[Your Signature]
[Your Printed Name]
                        </pre>
                    </div>

                    <div class="card">
                        <h4>✉️ Email Template: To Korean Consulate</h4>
                        <pre>
Subject: E-2 Visa Application Inquiry - [Your Name]

Dear Consulate Staff,

I am a U.S. citizen preparing to apply for an E-2 teaching visa.

I have received my VIN (Visa Issuance Number): [VIN NUMBER]

Could you please confirm:
1. Required documents for E-2 visa application
2. Visa processing time (standard)
3. Whether in-person application is required
4. Visa fee amount and acceptable payment methods

I am currently residing in [Your State] and plan to submit
my application on [Date].

Thank you for your assistance.

Sincerely,
[Your Full Name]
[Your Email]
[Your Phone Number]
                        </pre>
                    </div>

                    <div class="card">
                        <h4>📧 Email Template: To Employer (After Shipping)</h4>
                        <pre>
Subject: Document Package Shipped - Tracking [Number]

Dear [Employer Name],

I have shipped my complete E-2 visa document package today
via [FedEx/DHL/UPS].

Tracking Number: [TRACKING NUMBER]
Expected Delivery: [DATE]

You can track the package at: [TRACKING URL]

Package Contents:
✓ FBI background check with Federal apostille
✓ Bachelor's degree with State apostille
✓ Self-Health Statement
✓ Passport bio page copy
✓ Signed employment contract
✓ Resume/CV
✓ Passport photos (6 copies)

Please confirm receipt and let me know if you need anything else.

Best regards,
[Your Name]
                        </pre>
                    </div>

                    <div class="card">
                        <h4>📋 Self-Health Statement Template</h4>
                        <pre>
SELF-HEALTH STATEMENT

I, [Your Full Name], passport number [PASSPORT #], declare that:

1. I am in good physical and mental health.
2. I have no communicable diseases.
3. I have not used illegal drugs in the past 6 months.
4. I am not currently taking medication that would impair
   my ability to teach.
5. I understand that I must complete a health screening
   within 90 days of arrival in Korea.

I certify that the above information is true and accurate.

Date: [MM/DD/YYYY]
Signature: _______________________
Printed Name: [Your Full Name]
                        </pre>
                    </div>

                    <h3>Useful Formats</h3>

                    <div class="card-grid">
                        <div class="card">
                            <h4>Korean Address Format</h4>
                            <p><strong>English format (for shipping):</strong></p>
                            <pre>
[Recipient Name]
[Company/School Name]
[Street Address]
[Building Name/Number]
[District Name], [City Name]
[Postal Code]
SOUTH KOREA
                            </pre>
                            <p><strong>Example:</strong></p>
                            <pre>
Kim Min-soo
ABC English Academy
123 Gangnam-daero
Gangnam-gu, Seoul
06000
SOUTH KOREA
                            </pre>
                        </div>

                        <div class="card">
                            <h4>Notary Acknowledgment</h4>
                            <p><strong>What notary should write:</strong></p>
                            <pre>
State of [STATE]
County of [COUNTY]

On [DATE], before me, [NOTARY NAME],
personally appeared [YOUR NAME], who
proved to me on the basis of satisfactory
evidence to be the person whose name is
subscribed to this document, and
acknowledged that this is a true and
correct copy of their original Bachelor's
degree.

[Notary Signature]
[Notary Seal]
[Commission Expiration Date]
                            </pre>
                        </div>
                    </div>
                `
            },
            {
                id: 'glossary',
                title: '15. Glossary – Visa Terminology',
                content: `
                    <h3>E-2 Visa Key Terms</h3>

                    <table>
                        <thead>
                            <tr>
                                <th>Term</th>
                                <th>Definition</th>
                                <th>Korean</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>E-2 Visa</strong></td>
                                <td>Foreign language instructor visa for teaching conversational English in Korea</td>
                                <td>E-2 비자</td>
                            </tr>
                            <tr>
                                <td><strong>CCVI</strong></td>
                                <td>Certificate for Confirmation of Visa Issuance (same as VIN)</td>
                                <td>사증발급인정서</td>
                            </tr>
                            <tr>
                                <td><strong>VIN</strong></td>
                                <td>Visa Issuance Number (4 letters + 8 numbers)</td>
                                <td>비자발급번호</td>
                            </tr>
                            <tr>
                                <td><strong>Apostille</strong></td>
                                <td>Official certification that makes documents valid internationally under Hague Convention</td>
                                <td>아포스티유</td>
                            </tr>
                            <tr>
                                <td><strong>Federal Apostille</strong></td>
                                <td>Apostille from U.S. Department of State (for FBI checks)</td>
                                <td>연방 아포스티유</td>
                            </tr>
                            <tr>
                                <td><strong>State Apostille</strong></td>
                                <td>Apostille from Secretary of State (for degrees)</td>
                                <td>주정부 아포스티유</td>
                            </tr>
                            <tr>
                                <td><strong>FBI Channeler</strong></td>
                                <td>FBI-approved agency that provides fingerprinting and fast background checks (24-72 hours)</td>
                                <td>FBI 대행 기관</td>
                            </tr>
                            <tr>
                                <td><strong>ARC</strong></td>
                                <td>Alien Registration Card - your Korean ID card (must get within 90 days)</td>
                                <td>외국인등록증</td>
                            </tr>
                            <tr>
                                <td><strong>HIKOREA</strong></td>
                                <td>Immigration office - where you get ARC and handle visa matters</td>
                                <td>출입국관리사무소</td>
                            </tr>
                            <tr>
                                <td><strong>Health Screening</strong></td>
                                <td>Mandatory medical exam including drug test (must complete within 90 days)</td>
                                <td>건강검진</td>
                            </tr>
                            <tr>
                                <td><strong>Notarization</strong></td>
                                <td>Official certification by notary public that a document copy is authentic</td>
                                <td>공증</td>
                            </tr>
                            <tr>
                                <td><strong>Live Scan</strong></td>
                                <td>Digital fingerprinting method (used by FBI channelers)</td>
                                <td>전자 지문</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Document Abbreviations</h3>

                    <table>
                        <thead>
                            <tr>
                                <th>Abbreviation</th>
                                <th>Full Name</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>FBI</td>
                                <td>Federal Bureau of Investigation</td>
                                <td>Issues background checks</td>
                            </tr>
                            <tr>
                                <td>CJIS</td>
                                <td>Criminal Justice Information Services</td>
                                <td>FBI division that issues background checks</td>
                            </tr>
                            <tr>
                                <td>DOS</td>
                                <td>Department of State</td>
                                <td>Issues Federal apostilles</td>
                            </tr>
                            <tr>
                                <td>SOS</td>
                                <td>Secretary of State</td>
                                <td>Issues State apostilles</td>
                            </tr>
                            <tr>
                                <td>MOE</td>
                                <td>Ministry of Education</td>
                                <td>Korean education authority</td>
                            </tr>
                            <tr>
                                <td>MOFA</td>
                                <td>Ministry of Foreign Affairs</td>
                                <td>Korean foreign affairs authority</td>
                            </tr>
                            <tr>
                                <td>MOIS</td>
                                <td>Ministry of Interior and Safety</td>
                                <td>Oversees Korean immigration</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Korean Immigration Terms</h3>

                    <ul>
                        <li><strong>출입국 (Chulipguk):</strong> Immigration</li>
                        <li><strong>비자 (Bija):</strong> Visa</li>
                        <li><strong>여권 (Yeogwon):</strong> Passport</li>
                        <li><strong>체류 (Cheryu):</strong> Stay/Residence</li>
                        <li><strong>연장 (Yeonjang):</strong> Extension</li>
                        <li><strong>등록 (Deungrok):</strong> Registration</li>
                        <li><strong>신청 (Sincheong):</strong> Application</li>
                        <li><strong>허가 (Heoga):</strong> Permission/Approval</li>
                    </ul>

                    <div class="alert alert-info">
                        <h4>💡 Pro Tip</h4>
                        <p>Save this glossary for reference when communicating with Korean immigration offices or employers. Many terms are used interchangeably.</p>
                    </div>
                `
            },
            {
                id: 'consulate-directory',
                title: '16. Korean Consulate Directory – United States',
                content: `
                    <h3>Korean Consulates in the United States</h3>
                    <p><strong>Select consulate based on your state of residence:</strong></p>

                    <div class="card-grid">
                        <div class="card">
                            <h4>Korean Embassy - Washington, DC</h4>
                            <p><strong>Phone:</strong> <a href="tel:202-939-5600">202-939-5600</a></p>
                            <p><strong>Jurisdiction:</strong> DC, Maryland, Virginia, West Virginia</p>
                            <p><strong>Address:</strong> 2450 Massachusetts Ave NW, Washington, DC 20008</p>
                        </div>

                        <div class="card">
                            <h4>Consulate General - New York</h4>
                            <p><strong>Phone:</strong> <a href="tel:646-674-6000">646-674-6000</a></p>
                            <p><strong>Jurisdiction:</strong> NY, NJ, PA, DE, CT</p>
                            <p><strong>Address:</strong> 460 Park Ave, 5th Floor, New York, NY 10022</p>
                        </div>

                        <div class="card">
                            <h4>Consulate General - Los Angeles</h4>
                            <p><strong>Phone:</strong> <a href="tel:213-385-9300">213-385-9300</a></p>
                            <p><strong>Jurisdiction:</strong> Southern CA, AZ, NV, NM</p>
                            <p><strong>Address:</strong> 3243 Wilshire Blvd, Los Angeles, CA 90010</p>
                        </div>

                        <div class="card">
                            <h4>Consulate General - San Francisco</h4>
                            <p><strong>Phone:</strong> <a href="tel:415-921-2251">415-921-2251</a></p>
                            <p><strong>Jurisdiction:</strong> Northern CA, UT, CO</p>
                            <p><strong>Address:</strong> 3500 Clay St, San Francisco, CA 94118</p>
                        </div>

                        <div class="card">
                            <h4>Consulate General - Chicago</h4>
                            <p><strong>Phone:</strong> <a href="tel:312-822-9485">312-822-9485</a></p>
                            <p><strong>Jurisdiction:</strong> IL, IN, IA, KS, MI, MN, MO, NE, ND, OH, SD, WI, KY</p>
                            <p><strong>Address:</strong> NBC Tower Suite 2700, Chicago, IL 60611</p>
                        </div>

                        <div class="card">
                            <h4>Consulate General - Seattle</h4>
                            <p><strong>Phone:</strong> <a href="tel:206-441-1011">206-441-1011</a></p>
                            <p><strong>Jurisdiction:</strong> WA, OR, MT, ID, AK</p>
                            <p><strong>Address:</strong> 2033 6th Ave, Seattle, WA 98121</p>
                        </div>

                        <div class="card">
                            <h4>Consulate General - Atlanta</h4>
                            <p><strong>Phone:</strong> <a href="tel:404-522-1611">404-522-1611</a></p>
                            <p><strong>Jurisdiction:</strong> GA, AL, FL, NC, SC, TN</p>
                            <p><strong>Address:</strong> 229 Peachtree St NE, Suite 500, Atlanta, GA 30303</p>
                        </div>

                        <div class="card">
                            <h4>Consulate General - Boston</h4>
                            <p><strong>Phone:</strong> <a href="tel:617-348-3660">617-348-3660</a></p>
                            <p><strong>Jurisdiction:</strong> MA, ME, NH, RI, VT</p>
                            <p><strong>Address:</strong> One Gateway Center, Suite 2600, Newton, MA 02458</p>
                        </div>

                        <div class="card">
                            <h4>Consulate General - Houston</h4>
                            <p><strong>Phone:</strong> <a href="tel:713-961-0186">713-961-0186</a></p>
                            <p><strong>Jurisdiction:</strong> TX, AR, LA, MS, OK</p>
                            <p><strong>Address:</strong> 1990 Post Oak Blvd, Suite 1250, Houston, TX 77056</p>
                        </div>

                        <div class="card">
                            <h4>Consulate General - Honolulu</h4>
                            <p><strong>Phone:</strong> <a href="tel:808-595-6109">808-595-6109</a></p>
                            <p><strong>Jurisdiction:</strong> Hawaii, Guam, American Samoa</p>
                            <p><strong>Address:</strong> 2756 Pali Hwy, Honolulu, HI 96817</p>
                        </div>
                    </div>
                `
            },
            {
                id: 'government-resources',
                title: '17. Korean Government Resources – Official Information',
                content: `
                    <h3>Korea Immigration Service</h3>

                    <div class="card card-highlight">
                        <h4>Korea Immigration Service (출입국관리사무소)</h4>
                        <p><strong>Website:</strong> <a href="https://immigration.go.kr/immigration_eng/index.do" target="_blank">immigration.go.kr/immigration_eng</a></p>
                        <p><strong>Phone from Korea:</strong> 1345</p>
                        <p><strong>Phone from abroad:</strong> +82-2-1345</p>
                        <p><strong>Hours:</strong> Mon-Fri 9 AM - 6 PM (Korea time)</p>
                        <p><strong>Languages:</strong> 20 languages available</p>
                        <p><strong>Use for:</strong> Visa inquiries, ARC questions, E-2 policy questions, immigration office locations</p>
                    </div>

                    <h3>Online Portals</h3>

                    <div class="card-grid">
                        <div class="card">
                            <h4>Hi Korea Portal</h4>
                            <p><strong>Website:</strong> <a href="https://hikorea.go.kr" target="_blank">hikorea.go.kr</a></p>
                            <p><strong>Services:</strong></p>
                            <ul>
                                <li>Online visa applications</li>
                                <li>Visa status checks</li>
                                <li>ARC applications and renewals</li>
                                <li>Immigration office appointments</li>
                                <li>Change of address notifications</li>
                            </ul>
                            <p><strong>Account:</strong> Required (free registration)</p>
                        </div>

                        <div class="card">
                            <h4>Korea Visa Portal</h4>
                            <p><strong>Website:</strong> <a href="https://visa.go.kr" target="_blank">visa.go.kr</a></p>
                            <p><strong>Use for:</strong></p>
                            <ul>
                                <li>Visa application forms (download)</li>
                                <li>VIN verification</li>
                                <li>Visa status tracking</li>
                                <li>Visa policy information</li>
                            </ul>
                        </div>
                    </div>

                    <h3>U.S. Government Resources</h3>

                    <div class="card-grid">
                        <div class="card">
                            <h4>FBI Background Check</h4>
                            <p><strong>Website:</strong> <a href="https://www.fbi.gov/how-we-can-help-you/more-fbi-services-and-information/identity-history-summary-checks" target="_blank">fbi.gov/identity-history-summary-checks</a></p>
                            <p><strong>Direct DIY:</strong> 16-20 weeks processing</p>
                            <p><strong>Cost:</strong> $18 (mail-in)</p>
                            <p><strong>Note:</strong> Use FBI channeler for 24-72 hour results</p>
                        </div>

                        <div class="card">
                            <h4>U.S. Department of State</h4>
                            <p><strong>Apostille Office:</strong> Office of Authentications</p>
                            <p><strong>Website:</strong> <a href="https://travel.state.gov/content/travel/en/records-and-authentications/authenticate-your-document/apostille-requirements.html" target="_blank">travel.state.gov/apostille</a></p>
                            <p><strong>Use for:</strong> Federal apostilles (FBI checks)</p>
                            <p><strong>Processing:</strong> 2-4 weeks (or use service like Monument Visa)</p>
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <h4>💡 Bookmark These Resources</h4>
                        <p>Save these links for quick reference during your visa process and after arriving in Korea. The Hi Korea portal will be your primary tool for managing your visa status and ARC in Korea.</p>
                    </div>
                `
            },
            {
                id: 'service-providers',
                title: '18. Essential Service Providers – Trusted Partners',
                content: `
                    <div class="alert alert-success">
                        <h3>✅ Required Services</h3>
                        <p>These professional services are <strong>essential</strong> for completing your E-2 visa documents on time.</p>
                    </div>

                    <h3>Apostille Services</h3>

                    <div class="card card-highlight">
                        <h4>Monument Visa Service (REQUIRED)</h4>
                        <p><strong>Website:</strong> <a href="https://monumentvisa.com" target="_blank">monumentvisa.com</a></p>
                        <p><strong>Phone:</strong> <a href="tel:1-800-995-6924">1-800-995-6924</a></p>
                        <p><strong>Email:</strong> info@monumentvisa.com</p>
                        <p><strong>Location:</strong> Fairfax, VA (next to U.S. Dept of State offices)</p>
                        <p><strong>Services & Pricing:</strong></p>
                        <ul>
                            <li>FBI Federal apostille: $75</li>
                            <li>Degree State apostille: $125</li>
                            <li>Rush processing: 3-5 business days</li>
                            <li>Return shipping: included</li>
                        </ul>
                        <p><strong>Why Monument Visa:</strong></p>
                        <ul>
                            <li>Only company with direct access to U.S. Dept of State (Federal) AND all 50 State apostille offices</li>
                            <li>Handles both FBI check (Federal apostille) and degree (State apostille)</li>
                            <li>Fast turnaround (3-5 days vs. 2-4 weeks DIY)</li>
                            <li>Zero errors - they verify everything before submission</li>
                        </ul>
                    </div>

                    <h3>FBI Channelers (Background Checks)</h3>

                    <div class="card-grid">
                        <div class="card">
                            <h4>Accurate Biometrics (Recommended)</h4>
                            <p><strong>Website:</strong> <a href="https://accuratebiometrics.com" target="_blank">accuratebiometrics.com</a></p>
                            <p><strong>Locations:</strong> 825+ nationwide</p>
                            <p><strong>Cost:</strong> $40-100</p>
                            <p><strong>Processing:</strong> 24-72 hours</p>
                            <p><strong>How it works:</strong></p>
                            <ol>
                                <li>Book online appointment</li>
                                <li>Visit location for 5-minute fingerprinting</li>
                                <li>Receive FBI check via email in 1-3 days</li>
                            </ol>
                        </div>

                        <div class="card">
                            <h4>Fieldprint</h4>
                            <p><strong>Website:</strong> <a href="https://www.fieldprintusa.com" target="_blank">fieldprintusa.com</a></p>
                            <p><strong>Locations:</strong> 500+ nationwide</p>
                            <p><strong>Cost:</strong> $50-100</p>
                            <p><strong>Processing:</strong> 24-72 hours</p>
                        </div>
                    </div>

                    <h3>International Shipping</h3>

                    <div class="card-grid">
                        <div class="card">
                            <h4>FedEx International Priority</h4>
                            <p><strong>Website:</strong> <a href="https://www.fedex.com" target="_blank">fedex.com</a></p>
                            <p><strong>Delivery:</strong> 2-5 business days to Korea</p>
                            <p><strong>Cost:</strong> $40-80</p>
                            <p><strong>Tracking:</strong> Full tracking to Korea</p>
                        </div>

                        <div class="card">
                            <h4>DHL Express Worldwide</h4>
                            <p><strong>Website:</strong> <a href="https://www.dhl.com" target="_blank">dhl.com</a></p>
                            <p><strong>Delivery:</strong> 2-5 business days to Korea</p>
                            <p><strong>Cost:</strong> $40-80</p>
                            <p><strong>Tracking:</strong> Full tracking to Korea</p>
                        </div>

                        <div class="card">
                            <h4>UPS Worldwide Expedited</h4>
                            <p><strong>Website:</strong> <a href="https://www.ups.com" target="_blank">ups.com</a></p>
                            <p><strong>Delivery:</strong> 2-5 business days to Korea</p>
                            <p><strong>Cost:</strong> $40-80</p>
                            <p><strong>Tracking:</strong> Full tracking to Korea</p>
                        </div>
                    </div>

                    <div class="alert alert-warning">
                        <h4>⚠️ NEVER Use USPS</h4>
                        <p>USPS International has unreliable tracking in Korea. Korean postal service often loses visibility once package enters Korea. Always use FedEx, DHL, or UPS.</p>
                    </div>

                    <h3>Notary & Photos</h3>

                    <div class="card-grid">
                        <div class="card">
                            <h4>Notary Public</h4>
                            <p><strong>Where to find:</strong></p>
                            <ul>
                                <li>UPS Store: $10-15/document</li>
                                <li>Banks (often free for customers)</li>
                                <li>AAA offices (free for AAA members)</li>
                                <li>Mobile notaries: $20-50</li>
                            </ul>
                            <p><strong>What to bring:</strong> Original degree + valid ID</p>
                        </div>

                        <div class="card">
                            <h4>Passport Photos</h4>
                            <p><strong>Where to go:</strong></p>
                            <ul>
                                <li>CVS/Walgreens: $10-20 for 6-8 photos</li>
                                <li>Costco Photo Center: $5-8 (best value)</li>
                                <li>UPS Store: $15-20</li>
                            </ul>
                            <p><strong>Specs:</strong> 2"x2" (5cm x 5cm), white background, recent photo</p>
                        </div>
                    </div>

                    <div class="alert alert-success">
                        <h3>💰 Total Service Cost Estimate</h3>
                        <ul>
                            <li>FBI Channeler: $40-100</li>
                            <li>Monument Visa apostilles: $200</li>
                            <li>Notary: $10-15</li>
                            <li>Photos: $10-20</li>
                            <li>Shipping to Monument: $20</li>
                            <li>Shipping to Korea: $40-80</li>
                        </ul>
                        <p><strong>Total: $320-435</strong></p>
                        <p><strong>Timeline: 2-3 weeks</strong> (vs. 16-20 weeks DIY)</p>
                    </div>

                    <div class="alert alert-info">
                        <h4>💡 Pro Tips</h4>
                        <ul>
                            <li><strong>Book FBI channeler FIRST:</strong> Gets the clock started on your 6-month validity</li>
                            <li><strong>Use Monument Visa:</strong> Don't try to DIY apostilles - too slow and error-prone</li>
                            <li><strong>Get extra passport photos:</strong> You'll need them in Korea for ARC, health check, etc.</li>
                            <li><strong>Save all tracking numbers:</strong> Email them to yourself, your employer, and Kang & Kriel</li>
                        </ul>
                    </div>
                `
            }
        ];

        // Timeline data for interactive tracking
        const timelineData = [
            {
                week: 'Week 1-3',
                title: 'Document Preparation Phase',
                duration: '2-3 weeks',
                color: 'primary',
                tasks: [
                    {
                        id: 'timeline-fbi-1',
                        day: 'Day 1',
                        title: 'Book FBI Channeler Appointment',
                        description: 'Schedule at Accurate Biometrics or Fieldprint',
                        urgent: true,
                        critical: true
                    },
                    {
                        id: 'timeline-fbi-2',
                        day: 'Day 1-2',
                        title: 'Get FBI Fingerprints',
                        description: 'Live Scan digital fingerprinting (5 minutes)',
                        cost: { min: 40, max: 100 },
                        urgent: true
                    },
                    {
                        id: 'timeline-degree-1',
                        day: 'Day 1',
                        title: 'Locate Original Degree',
                        description: 'Must be original, not a copy',
                        critical: true
                    },
                    {
                        id: 'timeline-degree-2',
                        day: 'Day 2-3',
                        title: 'Get Degree Notarized',
                        description: 'Notary public certification of original',
                        cost: { min: 10, max: 30 }
                    },
                    {
                        id: 'timeline-monument-1',
                        day: 'Day 3-4',
                        title: 'Order Monument Visa Service',
                        description: 'FBI federal apostille ($55-75) + Degree state apostille ($100-125)',
                        cost: { min: 155, max: 200 },
                        urgent: true,
                        critical: true
                    },
                    {
                        id: 'timeline-shipping-1',
                        day: 'Day 5-7',
                        title: 'Ship Documents to Monument',
                        description: 'FedEx/UPS with tracking ($40-80)',
                        cost: { min: 40, max: 80 }
                    }
                ]
            },
            {
                week: 'Week 2-3',
                title: 'Apostille Processing Phase',
                duration: '1-2 weeks',
                color: 'dark',
                tasks: [
                    {
                        id: 'timeline-wait-1',
                        day: 'Day 7-14',
                        title: 'Wait for FBI Results',
                        description: 'Channeler processes in 1-3 business days'
                    },
                    {
                        id: 'timeline-monument-2',
                        day: 'Day 10-14',
                        title: 'Monument Processes Apostilles',
                        description: 'Federal (FBI): 3-5 days, State (Degree): 5-7 days'
                    },
                    {
                        id: 'timeline-receive-1',
                        day: 'Day 14-21',
                        title: 'Receive Apostilled Documents',
                        description: 'Track Monument return shipment',
                        critical: true
                    }
                ]
            },
            {
                week: 'Week 3-4',
                title: 'Ship Documents to Korea',
                duration: '1 week',
                color: 'primary',
                tasks: [
                    {
                        id: 'timeline-photo-1',
                        day: 'Day 21-22',
                        title: '📸 Get Visa Photos',
                        description: 'Korean visa specs: 3.5cm x 4.5cm, white background. Get multiple copies (10+ recommended).',
                        cost: { min: 30, max: 70 },
                        critical: true
                    },
                    {
                        id: 'timeline-review-1',
                        day: 'Day 22-23',
                        title: '📋 Document Review with K&K',
                        description: 'Final verification: All documents apostilled, names match exactly, photos meet specs. Prepare for shipping.',
                        urgent: true
                    },
                    {
                        id: 'timeline-ship-korea-1',
                        day: 'Day 23-24',
                        title: '📦 Ship Documents to Korean School',
                        description: 'CRITICAL: Use FedEx/DHL/UPS Express to school address provided by Kang & Kriel. Include: Apostilled FBI check, apostilled degree, passport copy, visa photos, completed forms. Arrival time: up to 5 days.',
                        cost: { min: 80, max: 150 },
                        urgent: true,
                        critical: true
                    },
                    {
                        id: 'timeline-track-1',
                        day: 'Day 24-28',
                        title: '🔍 Track Package & Confirm Receipt',
                        description: 'Monitor tracking number daily. Confirm with school when received. They will combine your documents with school documents.',
                        urgent: true
                    }
                ]
            },
            {
                week: 'Week 4-5',
                title: 'CCVI Application in Korea (사증발급인정신청)',
                duration: '1-2 weeks',
                color: 'dark',
                tasks: [
                    {
                        id: 'timeline-cno-submit',
                        day: 'Day 28-30',
                        title: '🏛️ School Submits CCVI Application',
                        description: 'Korean employer submits "Certificate of Confirmation of Visa Issuance" (사증발급인정신청) to local immigration office with all combined documents. You do not need to be present.',
                        critical: true
                    },
                    {
                        id: 'timeline-cno-wait',
                        day: 'Day 30-42',
                        title: '⏳ Wait for CCVI Number',
                        description: 'Immigration office reviews application. Processing time: 1-2 weeks. School will receive notification when approved.',
                        urgent: false
                    },
                    {
                        id: 'timeline-cno-receive',
                        day: 'Day 42-45',
                        title: '📧 Receive CCVI & Visa Application Form',
                        description: 'Employer or K&K emails you: CCVI number (사증발급인정번호) and completed visa application form. Verify all information is correct.',
                        urgent: true,
                        critical: true
                    }
                ]
            },
            {
                week: 'Week 6-7',
                title: 'Consulate Application & Visa Issuance',
                duration: '1-2 weeks',
                color: 'primary',
                tasks: [
                    {
                        id: 'timeline-app-complete',
                        day: 'Day 45-46',
                        title: '✍️ Complete Visa Application',
                        description: 'Fill out visa application form with CCVI number. Sign all required sections. Print passport photos.',
                        urgent: true
                    },
                    {
                        id: 'timeline-consulate-prep',
                        day: 'Day 46-47',
                        title: '📂 Prepare Consulate Package',
                        description: 'Required: Passport (valid 6+ months), visa application with CCVI, 1 photo, visa fee payment. Check your local consulate requirements.',
                        urgent: true,
                        critical: true
                    },
                    {
                        id: 'timeline-consulate-submit',
                        day: 'Day 47-48',
                        title: '🏛️ Submit to Korean Consulate',
                        description: 'Visit local Korean consulate or use mail service (varies by location). Pay visa fee: $45 USD equivalent. Processing: 5-10 business days.',
                        cost: { min: 45, max: 45 },
                        urgent: true,
                        critical: true
                    },
                    {
                        id: 'timeline-visa-wait',
                        day: 'Day 48-58',
                        title: '⏳ Wait for Visa Processing',
                        description: 'Consulate reviews with CCVI verification. Standard processing: 5-10 business days. Track status online or by phone.',
                        urgent: false
                    },
                    {
                        id: 'timeline-visa-receive',
                        day: 'Day 58-62',
                        title: '🎉 Receive E-2 Visa in Passport',
                        description: 'Pick up passport with E-2 visa sticker. Verify: Correct name, visa type (E-2), validity dates. Keep visa page clean and undamaged.',
                        critical: true
                    },
                    {
                        id: 'timeline-book-flight',
                        day: 'Day 62+',
                        title: '✈️ Book Flight to Korea',
                        description: 'Coordinate arrival date with school. Book flight. Prepare for departure. Review arrival procedures.',
                        urgent: true
                    }
                ]
            },
            {
                week: 'Week 0 – Arrival Week',
                title: 'CRITICAL: First Week in Korea',
                duration: '7 days',
                color: 'urgent',
                tasks: [
                    {
                        id: 'arrival-day-1',
                        day: '1',
                        title: '✈️ Arrive in Korea & Immigration',
                        description: 'Pass through immigration with E-2 visa. Keep all entry documents. Get temporary phone number if possible.',
                        urgent: true,
                        critical: true
                    },
                    {
                        id: 'arrival-health-check',
                        day: '1-2',
                        title: '🏥 Health Check at MOJ Designated Hospital',
                        description: 'CRITICAL: Visit designated hospital for health examination. Required for ARC application. Bring passport, visa, recent photo. Cost: ₩60,000-100,000. Results: same day or next day.',
                        urgent: true,
                        critical: true,
                        cost: { min: 60, max: 100 }
                    },
                    {
                        id: 'arrival-arc-application',
                        day: '3-5',
                        title: '📝 Apply for Alien Registration Card (ARC)',
                        description: 'Visit local immigration office IMMEDIATELY (do not wait 90 days!). Bring health check results, passport, photos, apartment contract. Fee: ₩39,000 (₩35,000 발급 + ₩4,000 우편). You will receive a receipt - this receipt is needed for education office registration.',
                        urgent: true,
                        critical: true,
                        cost: { min: 30, max: 30 }
                    },
                    {
                        id: 'arrival-bank-account',
                        day: '3-7',
                        title: '🏦 Open Bank Account',
                        description: 'Open account with ARC application receipt. Major banks: Shinhan, Woori, KB. Bring passport, ARC receipt, phone number, school employment letter.',
                        urgent: true
                    },
                    {
                        id: 'arrival-phone',
                        day: '2-5',
                        title: '📱 Get Phone Number & Internet',
                        description: 'Register phone with passport or ARC receipt. Major carriers: SK, KT, LG U+. Some schools provide phones. Needed for banking and daily life.',
                        urgent: true
                    },
                    {
                        id: 'arrival-moe-registration',
                        day: '7-10',
                        title: '🎓 Education Office Teacher Registration',
                        description: 'CRITICAL FOR EMPLOYMENT: Register with provincial/metro education office. Bring ARC application receipt, E-2 visa, all apostilled documents, employment contract. Your school HR will coordinate timing. You CANNOT officially teach until this is complete.',
                        urgent: true,
                        critical: true
                    },
                    {
                        id: 'arrival-orientation',
                        day: '5-7',
                        title: '🏫 School Orientation',
                        description: 'Attend school orientation, meet co-teachers, review curriculum. Ask about: class schedule, materials, evaluation system, school culture.',
                        urgent: false
                    }
                ]
            },
            {
                week: 'Week 1-2 – Post-Arrival',
                title: 'Settlement & Card Collection',
                duration: '2 weeks',
                color: 'secondary',
                tasks: [
                    {
                        id: 'post-arc-pickup',
                        day: '14-21',
                        title: '🎫 Collect ARC Card',
                        description: 'Return to immigration office to collect your ARC card. Bring receipt and passport. KEEP THIS CARD SAFE - it is your primary ID in Korea.',
                        urgent: true,
                        critical: true
                    },
                    {
                        id: 'post-bank-update',
                        day: '14-21',
                        title: '🏦 Update Bank with ARC',
                        description: 'Bring physical ARC card to bank to complete account setup. Enables online banking, ATM card, mobile app access.',
                        urgent: true
                    },
                    {
                        id: 'post-phone-update',
                        day: '14-21',
                        title: '📱 Update Phone Registration',
                        description: 'Update phone carrier with ARC number. Enables full service, better plans, contract options.',
                        urgent: false
                    },
                    {
                        id: 'post-insurance',
                        day: '7-14',
                        title: '🏥 National Health Insurance',
                        description: 'You are automatically enrolled. Premium (~5% of salary) is deducted from paycheck. Register at local NHIS office for card. Provides comprehensive coverage.',
                        urgent: false
                    },
                    {
                        id: 'post-pension',
                        day: '7-14',
                        title: '💰 National Pension (Optional)',
                        description: 'Can request exemption if staying <1 year. Otherwise enrolled automatically. Can apply for refund when leaving Korea.',
                        urgent: false
                    },
                    {
                        id: 'post-explore',
                        day: '1-14',
                        title: '🗺️ Explore & Settle In',
                        description: 'Find grocery stores, restaurants, subway routes, post office, hospital. Join expat communities. Download essential apps: Naver Map, Papago, KakaoTalk.',
                        urgent: false
                    }
                ]
            }
        ];

        // ========================================
        // PHASE 1.3: VERSION MANAGEMENT & UNDO
        // ========================================
        const STORAGE_VERSION = '1.0';
        const STORAGE_KEY = `e2-visa-progress-v${STORAGE_VERSION}`;

        let checklistItems = {};

        // Undo stack (최근 5개 작업)
        let undoStack = [];
        const MAX_UNDO = 5;

        // Search index for Phase 2
        let searchIndex = [];

        // Load saved progress from localStorage with version management
        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    // Version check
                    if (data.version === STORAGE_VERSION) {
                        checklistItems = data.checkedItems || {};
                    } else {
                        // Fallback to old format
                        checklistItems = data;
                    }
                } catch (e) {
                    console.error('Failed to load progress', e);
                }
            }
            updateProgress();
            updateDashboard();
        }

        // Save progress to localStorage with version management
        function saveProgress() {
            try {
                const data = {
                    version: STORAGE_VERSION,
                    lastUpdated: new Date().toISOString(),
                    checkedItems: checklistItems
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                updateProgress();
                updateDashboard();
            } catch (e) {
                if (e.name === 'QuotaExceededError') {
                    showToast('Storage full. Please export your progress.', 'error');
                }
                console.error('Failed to save progress', e);
            }
        }

        // Reset progress function
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This will uncheck all completed tasks.')) {
                // Remove both old and new storage keys
                localStorage.removeItem('e2-visa-checklist'); // Old key
                localStorage.removeItem(STORAGE_KEY); // New key

                // Reset all checkboxes
                checklistItems = {};

                // Clear undo stack
                undoStack = [];
                const undoBtn = document.getElementById('undoBtn');
                if (undoBtn) {
                    undoBtn.disabled = true;
                }

                // Re-render everything
                const timelineContainer = document.getElementById('timeline-container');
                if (timelineContainer) {
                    timelineContainer.innerHTML = '';
                    renderTimeline();
                }

                renderSmartGuide();
                renderProgressInsights();
                updateProgress();
                updateDashboard();

                showToast('Progress reset', 'info');
            }
        }

        // Toast 알림 표시 함수
        function showToast(message, type = 'success') {
            // 기존 toast 제거
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            // 새 toast 생성
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icon = type === 'success' ? '✓' : type === 'error' ? '✗' : 'ℹ';
            toast.innerHTML = `
                <span style="font-size: 1rem; font-weight: var(--font-weight-bold);">${icon}</span>
                <span>${message}</span>
            `;

            document.body.appendChild(toast);

            // 애니메이션을 위해 약간의 지연 후 show 클래스 추가
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);

            // 3초 후 자동 제거
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Toggle checkbox with animation and undo support
        function toggleCheckbox(id) {
            const wasChecked = checklistItems[id];

            // PHASE 1.3: Add to undo stack
            undoStack.push({
                id: id,
                state: wasChecked || false,
                timestamp: Date.now()
            });

            // 스택 크기 제한
            if (undoStack.length > MAX_UNDO) {
                undoStack.shift();
            }

            // Undo 버튼 활성화
            const undoBtn = document.getElementById('undoBtn');
            if (undoBtn) {
                undoBtn.disabled = false;
            }

            checklistItems[id] = !wasChecked;

            // 시각적 피드백: 체크박스 부모 요소에 애니메이션 추가
            const checkbox = document.getElementById(id);
            if (checkbox && checkbox.parentElement) {
                checkbox.parentElement.classList.add('checkbox-animate');
                setTimeout(() => {
                    checkbox.parentElement.classList.remove('checkbox-animate');
                }, 300);
            }

            // Toast 알림 표시
            if (checklistItems[id]) {
                showToast('Task completed', 'success');
            } else {
                showToast('Task unchecked', 'info');
            }

            saveProgress();

            // Re-render timeline to update progress
            const timelineContainer = document.getElementById('timeline-container');
            if (timelineContainer) {
                timelineContainer.innerHTML = '';
                renderTimeline();
            }
        }

        // Update progress bar with accessibility
        function updateProgress() {
            const checkboxes = document.querySelectorAll('.checklist-item input[type="checkbox"]');
            const total = checkboxes.length;
            let completed = 0;

            checkboxes.forEach(cb => {
                const id = cb.id;
                if (checklistItems[id]) {
                    cb.checked = true;
                    cb.setAttribute('aria-checked', 'true');
                    cb.parentElement.classList.add('completed');
                    completed++;
                } else {
                    cb.checked = false;
                    cb.setAttribute('aria-checked', 'false');
                    cb.parentElement.classList.remove('completed');
                }
            });

            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            console.log('[Progress] Updated:', {completed, total, percentage: percentage + '%'});
            const progressBar = document.getElementById('progressBar');
            const progressBarContainer = progressBar ? progressBar.parentElement : null;
            const progressText = document.getElementById('progressText');
            const progressSRText = document.getElementById('progressSRText');

            if (progressBar && progressText) {
                progressBar.style.width = percentage + '%';
                progressBar.textContent = percentage + '%';
                progressText.textContent = `${completed} of ${total} tasks completed`;

                // Update ARIA attributes
                if (progressBarContainer) {
                    progressBarContainer.setAttribute('aria-valuenow', percentage);
                }

                if (progressSRText) {
                    progressSRText.textContent = `${percentage}% complete`;
                }
            }
        }

        // Toggle section with accessibility
        function toggleSection(sectionId) {
            const header = document.getElementById(sectionId + '-header');
            const content = document.getElementById(sectionId + '-content');

            if (header && content) {
                const isExpanded = header.classList.contains('expanded');

                header.classList.toggle('expanded');
                content.classList.toggle('expanded');

                // Update ARIA attributes
                header.setAttribute('aria-expanded', !isExpanded);
                content.setAttribute('aria-hidden', isExpanded);

                // Announce to screen readers
                const sectionName = header.querySelector('h2')?.textContent || 'Section';
                const announcement = !isExpanded
                    ? `${sectionName} expanded`
                    : `${sectionName} collapsed`;

                // Create temporary live region for announcement
                announceToScreenReader(announcement);
            }
        }

        // Announce to screen reader
        function announceToScreenReader(message) {
            const liveRegion = document.createElement('div');
            liveRegion.setAttribute('role', 'status');
            liveRegion.setAttribute('aria-live', 'polite');
            liveRegion.className = 'sr-only';
            liveRegion.textContent = message;

            document.body.appendChild(liveRegion);

            setTimeout(() => {
                document.body.removeChild(liveRegion);
            }, 1000);
        }

        // Get next incomplete task
        function getNextTask() {
            // Collect all tasks from timeline data
            const allTasks = timelineData.flatMap(week =>
                week.tasks.map(task => ({
                    ...task,
                    week: week.week,
                    weekTitle: week.title
                }))
            );

            // Find first uncompleted task
            const nextTask = allTasks.find(task => !checklistItems[task.id]);

            return nextTask;
        }

        // Generate progress insights
        function generateInsights() {
            const allTasks = timelineData.flatMap(week => week.tasks);
            const totalTasks = allTasks.length;
            const completedTasks = allTasks.filter(t => checklistItems[t.id]).length;
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            let insight = "";
            let encouragement = "";
            let icon = "";
            let tips = [];

            if (completionRate === 0) {
                icon = "🚀";
                insight = "Ready to Start Your Visa Journey?";
                encouragement = "Let's get started! Begin with booking your FBI channeler appointment - it's the most time-sensitive task.";
                tips = [
                    "FBI channeler booking should be your first priority",
                    "The entire process takes 5-7 weeks on average",
                    "Budget $320-525 for document preparation"
                ];
            } else if (completionRate < 25) {
                icon = "💪";
                insight = "You're Just Getting Started!";
                encouragement = "Great progress! Focus on completing Week 1 tasks to stay on schedule.";
                tips = [
                    "Keep momentum - complete FBI fingerprinting ASAP",
                    "Start degree notarization in parallel",
                    "Track all expenses for budgeting"
                ];
            } else if (completionRate < 50) {
                icon = "🎯";
                insight = "You're Making Solid Progress!";
                encouragement = "You're on track! Keep going with document submissions.";
                tips = [
                    "Monument Visa should have your documents soon",
                    "Start gathering passport photos",
                    "Review your employment contract carefully"
                ];
            } else if (completionRate < 75) {
                icon = "🎉";
                insight = "More Than Halfway There!";
                encouragement = "Excellent work! The finish line is in sight.";
                tips = [
                    "Prepare for consulate appointment",
                    "Double-check all document names match your passport",
                    "Start planning your move to Korea"
                ];
            } else if (completionRate < 100) {
                icon = "🏁";
                insight = "Almost Done!";
                encouragement = "Final push! Just a few more tasks to complete.";
                tips = [
                    "Review all documents one last time",
                    "Confirm consulate appointment details",
                    "Book your flight once visa is approved"
                ];
            } else {
                icon = "🎊";
                insight = "Congratulations! All Tasks Complete!";
                encouragement = "You've completed the entire checklist. Safe travels to Korea!";
                tips = [
                    "Keep all original documents safe",
                    "Complete health screening within 90 days of arrival",
                    "Apply for ARC within 90 days"
                ];
            }

            return { insight, encouragement, completionRate, icon, tips };
        }

        // Render smart guide widget
        function renderSmartGuide() {
            const container = document.getElementById('smart-guide-container');
            if (!container) return;

            // Check for arrival date proximity alerts
            const preferences = JSON.parse(localStorage.getItem('e2-visa-preferences') || '{}');
            const arrivalDate = preferences.arrivalDate ? new Date(preferences.arrivalDate) : null;
            const today = new Date();

            let urgentArrivalAlert = '';

            if (arrivalDate) {
                const daysUntilArrival = Math.ceil((arrivalDate - today) / (1000 * 60 * 60 * 24));

                // 7 days before arrival
                if (daysUntilArrival <= 7 && daysUntilArrival > 0) {
                    urgentArrivalAlert = `
                        <div class="alert alert-warning" style="margin-bottom: 20px; animation: pulseAlert 2s infinite;">
                            <h3>🎯 Arriving in ${daysUntilArrival} day${daysUntilArrival !== 1 ? 's' : ''}!</h3>
                            <p><strong>PREPARE NOW for immediate actions upon arrival:</strong></p>
                            <ul>
                                <li>📍 Locate nearest MOJ designated hospital for health check</li>
                                <li>💵 Prepare ₩100,000 cash for health check</li>
                                <li>📸 Get 3 passport photos (3.5cm × 4.5cm, white background)</li>
                                <li>📞 Confirm school HR will accompany you to education office</li>
                                <li>📄 Keep all visa documents together and accessible</li>
                            </ul>
                            <button class="btn btn-primary" onclick="document.getElementById('after-arrival').scrollIntoView({behavior: 'smooth'}); toggleSection('after-arrival');" style="margin-top: 10px;">
                                📋 View First Week Checklist
                            </button>
                        </div>
                    `;
                }
                // Already in Korea (0-7 days after arrival)
                else if (daysUntilArrival <= 0 && daysUntilArrival > -7) {
                    const daysSinceArrival = Math.abs(daysUntilArrival);
                    urgentArrivalAlert = `
                        <div class="alert alert-danger" style="margin-bottom: 20px; animation: pulseAlert 1.5s infinite; border-left: 8px solid #dc2626;">
                            <h3>🚨 YOU ARE IN KOREA - IMMEDIATE ACTION REQUIRED!</h3>
                            <p style="font-size: 1.1rem; margin: 15px 0;"><strong>Day ${daysSinceArrival} in Korea</strong></p>

                            ${daysSinceArrival <= 2 ? `
                                <div style="background: #f1f5f9; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                    <h4 style="color: #dc2626; margin-top: 0;">TODAY/TOMORROW PRIORITY:</h4>
                                    <ol style="margin: 10px 0;">
                                        <li><strong>Go to MOJ designated hospital for health check</strong></li>
                                        <li>Get 건강진단서 (health certificate) - required for ARC</li>
                                        <li>Bring: Passport, ₩60,000-100,000, 1 passport photo</li>
                                    </ol>
                                </div>
                            ` : ''}

                            ${daysSinceArrival >= 3 ? `
                                <div style="background: #dbeafe; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                    <h4 style="color: #92400e; margin-top: 0;">NEXT PRIORITY:</h4>
                                    <ol style="margin: 10px 0;">
                                        <li><strong>Apply for ARC at immigration office</strong></li>
                                        <li>Bring: Health certificate, passport, 2 photos, housing contract, ₩30,000</li>
                                        <li><strong>KEEP YOUR RECEIPT (접수증)!</strong> - You need it for education office</li>
                                    </ol>
                                </div>
                            ` : ''}

                            <div class="quick-actions" style="margin-top: 15px;">
                                <button class="btn btn-primary" onclick="document.getElementById('after-arrival').scrollIntoView({behavior: 'smooth'}); toggleSection('after-arrival');">
                                    📅 View Critical First Week Timeline
                                </button>
                                <button class="btn btn-secondary" onclick="document.getElementById('faq').scrollIntoView({behavior: 'smooth'}); toggleSection('faq');">
                                    ❓ Why Can't I Wait 90 Days?
                                </button>
                            </div>
                        </div>
                    `;
                }
            }

            const nextTask = getNextTask();

            // Find the last completed task (for undo functionality)
            let lastCompletedTask = null;
            for (let i = timelineData.length - 1; i >= 0; i--) {
                const week = timelineData[i];
                for (let j = week.tasks.length - 1; j >= 0; j--) {
                    const task = week.tasks[j];
                    if (checklistItems[task.id]) {
                        lastCompletedTask = task;
                        break;
                    }
                }
                if (lastCompletedTask) break;
            }

            if (!nextTask) {
                container.innerHTML = urgentArrivalAlert + `
                    <div class="smart-guide-widget">
                        <div class="widget-header">
                            <h3>🎊 All Tasks Completed!</h3>
                        </div>
                        <div class="widget-content">
                            <div class="current-step">
                                <h4>Congratulations!</h4>
                                <p>You've completed all tasks in the E-2 visa process guide.</p>
                                <div class="quick-actions">
                                    <button class="btn btn-primary" onclick="window.print()">
                                        Print Completed Checklist
                                    </button>
                                    <button class="btn btn-secondary" onclick="exportProgress()">
                                        Export Progress
                                    </button>
                                    <button class="btn btn-outline" onclick="resetProgress()" style="border: 1px solid var(--color-border); background: transparent; color: var(--color-text-secondary);">
                                        ↶ Reset All Progress
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="widget-footer">
                            <p>💡 Tip: Keep all documents safe and complete health screening within 90 days of arrival in Korea.</p>
                        </div>
                    </div>
                `;
                return;
            }

            const estimatedTime = nextTask.urgent ? "30-60 minutes" : "15-30 minutes";
            const tipText = nextTask.critical
                ? "This is a critical task - complete it as soon as possible!"
                : "Take your time and follow the instructions carefully.";

            // Generate undo button HTML if there's a last completed task
            const undoButtonHtml = lastCompletedTask ? `
                <button class="btn btn-outline" onclick="toggleCheckbox('${lastCompletedTask.id}'); renderSmartGuide(); renderProgressInsights();" style="border: 1px solid var(--color-border); background: transparent;">
                    ↶ Undo Last Step
                </button>
            ` : '';

            container.innerHTML = urgentArrivalAlert + `
                <div class="smart-guide-widget">
                    <div class="widget-header">
                        <h3>🎯 Your Next Step</h3>
                        <span class="estimated-time">Est. ${estimatedTime}</span>
                    </div>
                    <div class="widget-content">
                        <div class="current-step">
                            <div style="margin-bottom: 12px;">
                                <span class="badge badge-info">${nextTask.day}</span>
                                ${nextTask.urgent ? '<span class="badge badge-urgent">URGENT</span>' : ''}
                                ${nextTask.critical ? '<span class="badge badge-critical">CRITICAL</span>' : ''}
                                ${nextTask.cost ? `<span class="badge" style="background: #22c55e; color: white;">$${nextTask.cost.min}-$${nextTask.cost.max}</span>` : ''}
                            </div>
                            <h4>${nextTask.title}</h4>
                            <p>${nextTask.description}</p>
                            <p style="font-size: var(--font-size-sm); color: #9ca3af;"><strong>${nextTask.week}:</strong> ${nextTask.weekTitle}</p>
                            <div class="quick-actions">
                                <button class="btn btn-primary" onclick="toggleCheckbox('${nextTask.id}'); renderSmartGuide(); renderProgressInsights();">
                                    ✓ Complete & Next Step
                                </button>
                                <button class="btn btn-secondary" onclick="toggleSection('interactive-timeline')">
                                    View Full Timeline
                                </button>
                                ${undoButtonHtml}
                            </div>
                        </div>
                    </div>
                    <div class="widget-footer">
                        <p>💡 Tip: ${tipText}</p>
                    </div>
                </div>
            `;
        }

        // Render progress insights
        function renderProgressInsights() {
            const container = document.getElementById('progress-insights-container');
            if (!container) return;

            const insights = generateInsights();

            // Calculate milestones
            const milestones = [
                {
                    title: "Document Preparation",
                    tasks: timelineData[0].tasks.length,
                    completed: timelineData[0].tasks.filter(t => checklistItems[t.id]).length
                },
                {
                    title: "Apostille Processing",
                    tasks: timelineData[1].tasks.length,
                    completed: timelineData[1].tasks.filter(t => checklistItems[t.id]).length
                },
                {
                    title: "Photos & Application",
                    tasks: timelineData[2].tasks.length,
                    completed: timelineData[2].tasks.filter(t => checklistItems[t.id]).length
                },
                {
                    title: "Submission & Processing",
                    tasks: timelineData[3].tasks.length,
                    completed: timelineData[3].tasks.filter(t => checklistItems[t.id]).length
                }
            ];

            container.innerHTML = `
                <div class="progress-insights">
                    <div class="insight-header">
                        <div class="insight-icon">${insights.icon}</div>
                        <div class="insight-text">
                            <h3>${insights.insight}</h3>
                            <p>${insights.encouragement}</p>
                        </div>
                    </div>

                    <div class="milestone-tracker">
                        ${milestones.map(milestone => {
                            const progress = milestone.tasks > 0
                                ? Math.round((milestone.completed / milestone.tasks) * 100)
                                : 0;
                            let status = 'pending';
                            let statusText = `${milestone.completed}/${milestone.tasks} tasks`;

                            if (progress === 100) {
                                status = 'completed';
                                statusText = '✓ Completed';
                            } else if (progress > 0) {
                                status = 'in-progress';
                                statusText = `${progress}% (${milestone.completed}/${milestone.tasks})`;
                            }

                            return `
                                <div class="milestone ${status}">
                                    <h4>${milestone.title}</h4>
                                    <div class="milestone-status">${statusText}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    ${insights.tips.length > 0 ? `
                        <div class="quick-tips">
                            <h4>💡 Quick Tips for Your Current Stage</h4>
                            <ul>
                                ${insights.tips.map(tip => `<li>${tip}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Expand all sections
        function expandAll() {
            document.querySelectorAll('.section-header').forEach(header => {
                header.classList.add('expanded');
            });
            document.querySelectorAll('.section-content').forEach(content => {
                content.classList.add('expanded');
            });
        }

        // Collapse all sections
        function collapseAll() {
            document.querySelectorAll('.section-header').forEach(header => {
                header.classList.remove('expanded');
            });
            document.querySelectorAll('.section-content').forEach(content => {
                content.classList.remove('expanded');
            });
        }

        // Export progress
        // PHASE 1.3: Enhanced export with version management
        function exportProgress() {
            const allTasks = timelineData.flatMap(w => w.tasks);
            const data = {
                version: STORAGE_VERSION,
                exportDate: new Date().toISOString(),
                checkedItems: checklistItems,
                totalTasks: allTasks.length,
                completedTasks: Object.values(checklistItems).filter(v => v).length
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `e2-visa-progress-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('Progress exported successfully', 'success');
        }

        // PHASE 1.3: Undo last action
        function undoLastAction() {
            if (undoStack.length === 0) return;

            const lastAction = undoStack.pop();
            checklistItems[lastAction.id] = lastAction.state;

            // UI 업데이트
            const checkbox = document.getElementById(lastAction.id);
            if (checkbox) {
                checkbox.checked = lastAction.state;
            }

            saveProgress();
            renderSmartGuide();
            renderProgressInsights();

            // Undo 버튼 비활성화 (스택 비었을 때)
            if (undoStack.length === 0) {
                const undoBtn = document.getElementById('undoBtn');
                if (undoBtn) {
                    undoBtn.disabled = true;
                }
            }

            showToast('Action undone', 'info');
        }

        // PHASE 1.2: Update dashboard
        function updateDashboard() {
            const allTasks = timelineData.flatMap(w => w.tasks);
            const total = allTasks.length;
            const completed = Object.values(checklistItems).filter(Boolean).length;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

            // 원형 진행률
            const circumference = 283;
            const offset = circumference - (percentage / 100) * circumference;
            const progressRing = document.getElementById('progress-ring');
            if (progressRing) {
                progressRing.style.strokeDashoffset = offset;
            }

            const percentageEl = document.getElementById('overall-percentage');
            if (percentageEl) {
                percentageEl.textContent = `${percentage}%`;
            }

            // 통계
            const tasksCompletedEl = document.getElementById('tasks-completed');
            if (tasksCompletedEl) {
                tasksCompletedEl.textContent = `${completed}/${total}`;
            }

            // 긴급 태스크 수
            const urgentTasks = allTasks.filter(t => (t.urgent || t.critical) && !checklistItems[t.id]).length;
            const urgentCountEl = document.getElementById('urgent-count');
            if (urgentCountEl) {
                urgentCountEl.textContent = urgentTasks;
            }

            // 남은 비용 계산
            const remainingCost = calculateRemainingCost();
            const estimatedCostEl = document.getElementById('estimated-cost');
            if (estimatedCostEl) {
                estimatedCostEl.textContent = `$${remainingCost.min}-$${remainingCost.max}`;
            }

            // 도착일까지 남은 일수
            const preferences = JSON.parse(localStorage.getItem('e2-visa-preferences') || '{}');
            const daysUntilEl = document.getElementById('days-until');
            if (daysUntilEl && preferences.arrivalDate) {
                const arrivalDate = new Date(preferences.arrivalDate);
                const today = new Date();
                const daysUntil = Math.ceil((arrivalDate - today) / (1000 * 60 * 60 * 24));
                daysUntilEl.textContent = daysUntil > 0 ? daysUntil : 'Arrived';
            }

            // 미니 프로그레스 바
            const miniProgressFill = document.getElementById('mini-progress-fill');
            if (miniProgressFill) {
                miniProgressFill.style.width = `${percentage}%`;
            }
        }

        // PHASE 1.2: Calculate remaining cost (미국에서의 비자 준비 비용만)
        function calculateRemainingCost() {
            let min = 0, max = 0;

            // 한국 도착 후 비용 제외 (건강검진, ARC 등)
            const excludeIds = ['arrival-health-check', 'arrival-arc-application'];

            timelineData.forEach(week => {
                week.tasks.forEach(task => {
                    // 체크되지 않았고, 비용이 있으며, 제외 목록에 없는 경우만 합산
                    if (!checklistItems[task.id] && task.cost && !excludeIds.includes(task.id)) {
                        min += task.cost.min || 0;
                        max += task.cost.max || 0;
                    }
                });
            });
            return { min, max };
        }

        // Render timeline
        function renderTimeline() {
            const timelineContainer = document.getElementById('timeline-container');
            if (!timelineContainer) return;

            // Calculate priority tasks
            const priorityTasks = timelineData
                .flatMap(w => w.tasks.map(t => ({ ...t, week: w.week })))
                .filter(t => (t.urgent || t.critical) && !checklistItems[t.id])
                .slice(0, 3);

            // Priority tasks section
            if (priorityTasks.length > 0) {
                const priorityHTML = `
                    <div style="margin-bottom: 20px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 15px;">⭐ Next Up - Priority Tasks</h3>
                        <div class="card-grid">
                            ${priorityTasks.map(task => `
                                <div class="card" style="background: linear-gradient(135deg, #f1f5f9, #e2e8f0); border-color: #3b82f6;">
                                    <div style="margin-bottom: 8px;">
                                        ${task.urgent ? '<span class="badge badge-urgent">URGENT</span>' : ''}
                                        ${task.critical ? '<span class="badge badge-critical">CRITICAL</span>' : ''}
                                    </div>
                                    <h4 style="margin-bottom: 5px;">${task.title}</h4>
                                    <p style="font-size: var(--font-size-sm); color: #666; margin-bottom: 5px;">${task.description}</p>
                                    <p style="font-size: var(--font-size-xs); color: #999;">${task.week}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                timelineContainer.innerHTML += priorityHTML;
            }

            // Week sections
            timelineData.forEach((week, weekIndex) => {
                const weekProgress = calculateWeekProgress(week.tasks);
                const bgColor = week.color === 'primary' ? '#ae6031' : '#8a4a25';
                const hoverColor = week.color === 'primary' ? '#8a4a25' : '#6d3a1e';

                const weekHTML = `
                    <div class="section" style="margin-bottom: 20px;">
                        <div class="section-header" id="timeline-week-${weekIndex}-header"
                             onclick="toggleSection('timeline-week-${weekIndex}')"
                             style="background: ${bgColor};">
                            <div>
                                <h3 style="margin-bottom: 5px; font-size: var(--font-h3);">${week.week}</h3>
                                <p style="font-size: var(--font-size-sm); opacity: 0.9;">${week.title} • ${week.duration}</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="text-align: right;">
                                    <div style="font-size: var(--font-size-xs); opacity: 0.9;">Week Progress</div>
                                    <div style="font-size: var(--font-h2); font-weight: var(--font-weight-bold);">${weekProgress}%</div>
                                </div>
                                <span class="toggle-icon">▼</span>
                            </div>
                        </div>
                        <div style="padding: 15px; background: #f9fafb;">
                            <div style="width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                                <div style="height: 100%; background: ${bgColor}; width: ${weekProgress}%; transition: width 0.5s;"></div>
                            </div>
                        </div>
                        <div class="section-content" id="timeline-week-${weekIndex}-content">
                            <div style="padding: 20px;">
                                ${week.tasks.map((task, taskIndex) => {
                                    const isCompleted = checklistItems[task.id];
                                    return `
                                        <div style="padding: 15px; margin-bottom: 12px; background: ${isCompleted ? '#f9fafb' : 'white'};
                                                    border: 2px solid ${isCompleted ? '#d1d5db' : '#e5e7eb'}; border-radius: 8px;
                                                    transition: all 0.3s;">
                                            <div style="display: flex; align-items: start; gap: 12px;">
                                                <input type="checkbox"
                                                       id="${task.id}"
                                                       ${isCompleted ? 'checked' : ''}
                                                       onchange="toggleCheckbox('${task.id}')"
                                                       style="width: 20px; height: 20px; margin-top: 3px; cursor: pointer; accent-color: ${bgColor};">
                                                <label for="${task.id}" style="flex: 1; cursor: pointer;">
                                                    <div style="margin-bottom: 8px;">
                                                        <span class="badge badge-info">Day ${task.day}</span>
                                                        ${task.urgent ? '<span class="badge badge-urgent">URGENT</span>' : ''}
                                                        ${task.critical ? '<span class="badge badge-critical">CRITICAL</span>' : ''}
                                                        ${task.cost ? `<span class="badge" style="background: #22c55e; color: white;">$${task.cost.min}-$${task.cost.max}</span>` : ''}
                                                        ${isCompleted ? '<span class="badge badge-success">✓ Completed</span>' : ''}
                                                    </div>
                                                    <h4 style="margin-bottom: 5px; ${isCompleted ? 'text-decoration: line-through; color: #9ca3af;' : ''}">${task.title}</h4>
                                                    <p style="font-size: var(--font-size-sm); color: ${isCompleted ? '#9ca3af' : '#6b7280'};">${task.description}</p>
                                                </label>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                `;
                timelineContainer.innerHTML += weekHTML;
            });
        }

        // Calculate week progress
        function calculateWeekProgress(tasks) {
            if (!tasks || tasks.length === 0) return 0;
            const completed = tasks.filter(t => checklistItems[t.id]).length;
            return Math.round((completed / tasks.length) * 100);
        }

        // Render all sections with accessibility
        function renderAllSections() {
            const mainContent = document.getElementById('mainContent');
            if (!mainContent) return;

            sectionsData.forEach(section => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section';
                sectionDiv.innerHTML = `
                    <button class="section-header"
                            id="${section.id}-header"
                            onclick="toggleSection('${section.id}')"
                            aria-expanded="false"
                            aria-controls="${section.id}-content"
                            type="button">
                        <h2>${section.title}</h2>
                        <span class="toggle-icon" aria-hidden="true">▼</span>
                    </button>
                    <div class="section-content"
                         id="${section.id}-content"
                         aria-hidden="true"
                         role="region"
                         aria-labelledby="${section.id}-header">
                        ${section.content}
                    </div>
                `;
                mainContent.appendChild(sectionDiv);
            });

            // Render timeline after sections
            setTimeout(() => {
                renderTimeline();
                updateProgress();
            }, 100);
        }

        // ========================================
        // PHASE 2: SEARCH FUNCTIONALITY
        // ========================================

        // Build search index
        function buildSearchIndex() {
            searchIndex = [];

            // Index all sections
            document.querySelectorAll('.section').forEach(section => {
                const title = section.querySelector('h2')?.textContent || '';
                const content = section.querySelector('.section-content')?.textContent || '';

                if (title) {
                    searchIndex.push({
                        id: section.id || section.querySelector('.section-header')?.id || '',
                        title: title,
                        content: content.substring(0, 500), // 처음 500자만
                        type: 'section'
                    });
                }
            });

            // Index all tasks
            timelineData.forEach(week => {
                week.tasks.forEach(task => {
                    searchIndex.push({
                        id: task.id,
                        title: task.title,
                        content: task.description,
                        week: week.week,
                        type: 'task'
                    });
                });
            });
        }

        // Highlight match
        function highlightMatch(text, query) {
            const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        // Truncate text
        function truncate(text, length) {
            return text.length > length ? text.substring(0, length) + '...' : text;
        }

        // Navigate to search result
        function navigateToResult(id, type) {
            const resultsContainer = document.getElementById('searchResults');
            const searchInput = document.getElementById('globalSearch');

            if (resultsContainer) resultsContainer.classList.remove('show');
            if (searchInput) searchInput.value = '';

            if (type === 'task') {
                // 해당 태스크로 이동
                const taskElement = document.getElementById(id);
                if (taskElement) {
                    const weekSection = taskElement.closest('.section');
                    if (weekSection) {
                        const weekContent = weekSection.querySelector('.section-content');
                        const weekHeader = weekSection.querySelector('.section-header');

                        // 섹션 펼치기
                        if (weekContent && !weekContent.classList.contains('expanded')) {
                            weekHeader?.click();
                        }

                        // 스크롤 및 하이라이트
                        setTimeout(() => {
                            taskElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            taskElement.classList.add('search-highlight');
                            setTimeout(() => taskElement.classList.remove('search-highlight'), 2000);
                        }, 300);
                    }
                }
            } else {
                // 섹션으로 이동
                const section = document.getElementById(id);
                if (section) {
                    section.scrollIntoView({ behavior: 'smooth' });
                    const header = section.querySelector('.section-header');
                    if (header && !section.querySelector('.section-content')?.classList.contains('expanded')) {
                        header.click();
                    }
                }
            }
        }

        // PHASE 1.3: Import functionality
        function setupImportFunctionality() {
            const importFileInput = document.getElementById('importFile');
            if (!importFileInput) return;

            importFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);

                        // 버전 체크
                        if (data.version && data.version !== STORAGE_VERSION) {
                            if (!confirm('This file is from a different version. Import anyway?')) {
                                return;
                            }
                        }

                        // 데이터 병합 (기존 데이터 보존 옵션)
                        const existingCount = Object.keys(checklistItems).length;
                        if (existingCount > 0) {
                            if (!confirm('You have existing progress. Overwrite it?')) {
                                // 병합 모드
                                checklistItems = { ...checklistItems, ...(data.checkedItems || data) };
                            } else {
                                checklistItems = data.checkedItems || data;
                            }
                        } else {
                            checklistItems = data.checkedItems || data;
                        }

                        saveProgress();
                        location.reload(); // 전체 UI 갱신

                    } catch (error) {
                        showToast('Invalid file format', 'error');
                        console.error('Import error:', error);
                    }
                };
                reader.readAsText(file);
            });
        }

        // Setup search functionality
        function setupSearchFunctionality() {
            const searchInput = document.getElementById('globalSearch');
            const resultsContainer = document.getElementById('searchResults');

            if (!searchInput || !resultsContainer) return;

            // 실시간 검색
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();

                if (query.length < 2) {
                    resultsContainer.classList.remove('show');
                    return;
                }

                // 검색 수행
                const results = searchIndex.filter(item =>
                    item.title.toLowerCase().includes(query) ||
                    item.content.toLowerCase().includes(query)
                ).slice(0, 10);

                // 결과 렌더링
                if (results.length > 0) {
                    resultsContainer.innerHTML = results.map(result => `
                        <div class="search-result-item"
                             onclick="navigateToResult('${result.id}', '${result.type}')"
                             role="option">
                            <div class="result-type">${result.type === 'task' ? '📋 Task' : '📚 Section'}</div>
                            <div class="result-title">${highlightMatch(result.title, query)}</div>
                            <div class="result-excerpt">${highlightMatch(truncate(result.content, 80), query)}</div>
                        </div>
                    `).join('');
                    resultsContainer.classList.add('show');
                } else {
                    resultsContainer.innerHTML = '<div class="search-no-results">No results found</div>';
                    resultsContainer.classList.add('show');
                }
            });

            // ESC 키로 검색 결과 닫기
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    resultsContainer.classList.remove('show');
                    searchInput.value = '';
                }
            });

            // 외부 클릭 시 검색 결과 닫기
            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !resultsContainer.contains(e.target)) {
                    resultsContainer.classList.remove('show');
                }
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[E2 Visa Guide] Initializing...');

            loadProgress();
            renderAllSections();
            renderSmartGuide();
            renderProgressInsights();

            // PHASE 2: Initialize search
            setTimeout(() => {
                buildSearchIndex();
                setupSearchFunctionality();
            }, 500);

            // PHASE 1.3: Initialize import
            setupImportFunctionality();

            // Initialize navigation enhancements
            initializeNavigationEnhancements();

            console.log('[E2 Visa Guide] Initialization complete');
        });

        // ========================================
        // NAVIGATION ENHANCEMENTS FUNCTIONS
        // ========================================

        function smoothScroll(event, targetId) {
            event.preventDefault();
            const element = document.getElementById(targetId);
            if (element) {
                const yOffset = -80; // Offset for sticky nav
                const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
                window.scrollTo({top: y, behavior: 'smooth'});

                // Update active TOC item
                document.querySelectorAll('.toc-item').forEach(item => item.classList.remove('active'));
                event.currentTarget.classList.add('active');
            }
        }

        function initializeNavigationEnhancements() {
            const backToTop = document.querySelector('.back-to-top');
            const quickJump = document.querySelector('.quick-jump');

            // Add null checks to prevent errors
            if (!backToTop || !quickJump) {
                console.warn('[Navigation] Elements not found:', {
                    backToTop: !!backToTop,
                    quickJump: !!quickJump
                });
            } else {
                console.log('[Navigation] Quick Jump and Back-to-Top initialized successfully');
            }

            // Back to top button visibility
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) {
                    if (backToTop) backToTop.classList.add('show');
                    if (quickJump) quickJump.classList.add('show');
                } else {
                    if (backToTop) backToTop.classList.remove('show');
                    if (quickJump) quickJump.classList.remove('show');
                }

                // Update active section in TOC and Quick Jump
                updateActiveSection();
            });

            // Back to top click handler
            if (backToTop) {
                backToTop.addEventListener('click', () => {
                    window.scrollTo({top: 0, behavior: 'smooth'});
                });
            }
        }

        function updateActiveSection() {
            const sections = [
                'next-step', 'timeline-header', 'smart-guide-header',
                'process-reality', 'pre-start-checklist', 'master-checklist',
                'faq', 'cost-guide'
            ];

            let currentSection = '';

            for (const sectionId of sections) {
                const element = document.getElementById(sectionId);
                if (element) {
                    const rect = element.getBoundingClientRect();
                    if (rect.top <= 150 && rect.bottom >= 150) {
                        currentSection = sectionId;
                        break;
                    }
                }
            }

            if (currentSection) {
                // Update TOC
                document.querySelectorAll('.toc-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('href') === '#' + currentSection) {
                        item.classList.add('active');
                    }
                });

                // Update Quick Jump
                document.querySelectorAll('.quick-jump-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('href') === '#' + currentSection) {
                        item.classList.add('active');
                    }
                });
            }
        }

        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                const yOffset = -80;
                const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
                window.scrollTo({top: y, behavior: 'smooth'});
            }
        }
    </script>

    <!-- Back to Top Button -->
    <button class="back-to-top" aria-label="Back to top" title="Back to top">
        ↑
    </button>

    <!-- Quick Jump Menu -->
    <div class="quick-jump" aria-label="Quick navigation menu">
        <a href="#next-step" class="quick-jump-item" onclick="scrollToSection('next-step'); return false;" title="Your Next Step">
            🎯
        </a>
        <a href="#timeline-header" class="quick-jump-item" onclick="scrollToSection('timeline-header'); return false;" title="Timeline">
            📅
        </a>
        <a href="#smart-guide-header" class="quick-jump-item" onclick="scrollToSection('smart-guide-header'); return false;" title="Smart Guide">
            🧭
        </a>
        <a href="#master-checklist" class="quick-jump-item" onclick="scrollToSection('master-checklist'); return false;" title="Master Checklist">
            📋
        </a>
        <a href="#faq" class="quick-jump-item" onclick="scrollToSection('faq'); return false;" title="FAQ">
            ❓
        </a>
    </div>

</body>
</html>
